<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fuxi Ma fuxi.ma@outlook.com">

<title>Exploring Canadian Education and Labour Market Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="NGS_Report_files/libs/clipboard/clipboard.min.js"></script>
<script src="NGS_Report_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="NGS_Report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="NGS_Report_files/libs/quarto-html/popper.min.js"></script>
<script src="NGS_Report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="NGS_Report_files/libs/quarto-html/anchor.min.js"></script>
<link href="NGS_Report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="NGS_Report_files/libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="NGS_Report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="NGS_Report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="NGS_Report_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary"><span class="header-section-number">1</span> Executive Summary</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a></li>
  <li><a href="#data-overview" id="toc-data-overview" class="nav-link" data-scroll-target="#data-overview"><span class="header-section-number">3</span> Data Overview</a>
  <ul>
  <li><a href="#national-graduates-survey--class-of-2020-data-collected-in-2023" id="toc-national-graduates-survey--class-of-2020-data-collected-in-2023" class="nav-link" data-scroll-target="#national-graduates-survey--class-of-2020-data-collected-in-2023"><span class="header-section-number">3.1</span> National Graduates Survey- class of 2020 (Data collected in 2023)</a></li>
  <li><a href="#ngs-questions" id="toc-ngs-questions" class="nav-link" data-scroll-target="#ngs-questions"><span class="header-section-number">3.2</span> NGS Questions</a></li>
  <li><a href="#response-code" id="toc-response-code" class="nav-link" data-scroll-target="#response-code"><span class="header-section-number">3.3</span> Response code</a></li>
  </ul></li>
  <li><a href="#extract-all-ngs-tables-to-excel" id="toc-extract-all-ngs-tables-to-excel" class="nav-link" data-scroll-target="#extract-all-ngs-tables-to-excel"><span class="header-section-number">4</span> Extract All NGS Tables to Excel</a>
  <ul>
  <li><a href="#function-for-getting-ngs-table" id="toc-function-for-getting-ngs-table" class="nav-link" data-scroll-target="#function-for-getting-ngs-table"><span class="header-section-number">4.1</span> Function for getting NGS table</a></li>
  </ul></li>
  <li><a href="#dashboard" id="toc-dashboard" class="nav-link" data-scroll-target="#dashboard"><span class="header-section-number">5</span> Dashboard</a>
  <ul>
  <li><a href="#interactive-table-explorer" id="toc-interactive-table-explorer" class="nav-link" data-scroll-target="#interactive-table-explorer"><span class="header-section-number">5.1</span> Interactive Table Explorer</a></li>
  <li><a href="#data-analysis-features" id="toc-data-analysis-features" class="nav-link" data-scroll-target="#data-analysis-features"><span class="header-section-number">5.2</span> Data Analysis Features</a>
  <ul>
  <li><a href="#statistical-summaries" id="toc-statistical-summaries" class="nav-link" data-scroll-target="#statistical-summaries"><span class="header-section-number">5.2.1</span> Statistical Summaries</a></li>
  <li><a href="#automated-visualizations" id="toc-automated-visualizations" class="nav-link" data-scroll-target="#automated-visualizations"><span class="header-section-number">5.2.2</span> Automated Visualizations</a></li>
  </ul></li>
  <li><a href="#technical-implementation" id="toc-technical-implementation" class="nav-link" data-scroll-target="#technical-implementation"><span class="header-section-number">5.3</span> Technical Implementation</a></li>
  <li><a href="#key-functionality" id="toc-key-functionality" class="nav-link" data-scroll-target="#key-functionality"><span class="header-section-number">5.4</span> Key Functionality</a></li>
  <li><a href="#visual-design" id="toc-visual-design" class="nav-link" data-scroll-target="#visual-design"><span class="header-section-number">5.5</span> Visual Design</a></li>
  <li><a href="#dashboard-app-http127.0.0.15000" id="toc-dashboard-app-http127.0.0.15000" class="nav-link" data-scroll-target="#dashboard-app-http127.0.0.15000"><span class="header-section-number">5.6</span> Dashboard App http://127.0.0.1:5000</a></li>
  </ul></li>
  <li><a href="#data-analysis-predictive-modeling" id="toc-data-analysis-predictive-modeling" class="nav-link" data-scroll-target="#data-analysis-predictive-modeling"><span class="header-section-number">6</span> Data Analysis &amp; Predictive Modeling</a>
  <ul>
  <li><a href="#employment-status-binary-classiffication" id="toc-employment-status-binary-classiffication" class="nav-link" data-scroll-target="#employment-status-binary-classiffication"><span class="header-section-number">6.1</span> Employment Status (Binary Classiffication)</a></li>
  <li><a href="#employment-income-linear-regression" id="toc-employment-income-linear-regression" class="nav-link" data-scroll-target="#employment-income-linear-regression"><span class="header-section-number">6.2</span> Employment Income (Linear Regression)</a></li>
  <li><a href="#program-tiers-based-on-employment-and-income-clustering" id="toc-program-tiers-based-on-employment-and-income-clustering" class="nav-link" data-scroll-target="#program-tiers-based-on-employment-and-income-clustering"><span class="header-section-number">6.3</span> Program Tiers Based on Employment and Income (Clustering)</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">7</span> Conclusion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="NGS_Report.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploring Canadian Education and Labour Market Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Fuxi Ma <a href="mailto:fuxi.ma@outlook.com" class="email">fuxi.ma@outlook.com</a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Executive Summary</h1>
<p>This analysis of the National Graduates Survey (NGS) 2020 transforms complex data into a clear strategic roadmap for enhancing graduate success and institutional positioning.</p>
<p>Core Insight: A graduateâ€™s field of study is the dominant predictor of their career launch, significantly outweighing demographic factors. Our analysis reveals a clear stratification of academic programs into distinct performance tiers based on employment rates and income outcomes.</p>
<p><strong>Key Findings:</strong></p>
<ul>
<li><p><strong>Program Tiers are Evident:</strong> Programs in Health, Computer Science, and Education form a top tier with employment rates exceeding 96% and strong incomes. In contrast, programs in Arts, Humanities, and Life Sciences face more challenging market outcomes.</p></li>
<li><p><strong>High Overall Employment:</strong> Most graduates (93%+) find employment, demonstrating the high value of a degree.</p></li>
<li><p><strong>Significant Income Disparity:</strong> While the average income is $59,568, the gap between the highest and lowest-earning programs exceeds $25,000, highlighting unequal ROI across disciplines.</p></li>
</ul>
<p><strong>Strategic Imperative:</strong> This data provides a mandate for action. We recommend a focused strategy to promote top-tier programs, systematically enhance lower-performing ones with integrated career learning, and implement data-informed student advising to guide choices. By leveraging these insights, we can improve graduate outcomes, ensure equitable success, and strengthen our institutional value proposition in a competitive landscape.</p>
</section>
<section id="introduction" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Introduction</h1>
<p>The <strong>National Graduates Survey (NGS) - Class of 2020</strong> provides a comprehensive look at the educational experiences and labour market outcomes of recent graduates in Canada. Collected in 2023, this dataset includes responses from 16,138 individuals across 114 variables, covering:</p>
<ul>
<li><strong>Demographics</strong> (age, gender, citizenship)<br>
</li>
<li><strong>Program details</strong> (field of study, level of education, delivery mode)<br>
</li>
<li><strong>Financial aid</strong> (student loans, scholarships, funding sources)<br>
</li>
<li><strong>Employment outcomes</strong> (income, job relevance, satisfaction)<br>
</li>
<li><strong>COVID-19 impacts</strong> (program completion, career plans)</li>
</ul>
<p>This report analyzes the NGS data to generate actionable insights for universities and policymakers. Key sections include:</p>
<ol type="1">
<li><strong>Data Overview</strong>: Methodology and dataset structure.<br>
</li>
<li><strong>Demographic Trends</strong>: Age, gender, and citizenship distributions.<br>
</li>
<li><strong>Economic Outcomes</strong>: Income disparities by field of study and region.<br>
</li>
<li><strong>Strategic Recommendations</strong>: Program development, student support, and COVID-19 resilience.</li>
</ol>
<p>Using Python (pandas, statsmodels) and interactive visualizations, I highlight critical patterns to bridge the gap between education and labour market needs.</p>
</section>
<section id="data-overview" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data Overview</h1>
<section id="national-graduates-survey--class-of-2020-data-collected-in-2023" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="national-graduates-survey--class-of-2020-data-collected-in-2023"><span class="header-section-number">3.1</span> National Graduates Survey- class of 2020 (Data collected in 2023)</h2>
<div id="9b2ee975" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file into a pandas DataFrame</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="st">'ngs2020.csv'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display basic information about the dataset</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    display(Markdown(<span class="st">"&lt;span style='color: green'&gt;Dataset information:&lt;/span&gt;"</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of rows: </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of columns: </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    df.info()</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    display(Markdown(<span class="st">"&lt;span style='color: green'&gt;Column names:&lt;/span&gt;"</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" "</span>.join(<span class="bu">list</span>(df.columns)),<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Number of missing data</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    missing_data <span class="op">=</span> df.isnull().<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> missing_data <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\033</span><span class="ss">[30;43mThere are no missing data.</span><span class="ch">\033</span><span class="ss">[0m"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\033</span><span class="ss">[30;43mThere are </span><span class="sc">{</span>missing_data<span class="sc">}</span><span class="ss"> missing data.</span><span class="ch">\033</span><span class="ss">[0m"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Error: The file 'ngs2020.csv' was not found in the current directory."</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> pd.errors.EmptyDataError:</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Error: The file 'ngs2020.csv' is empty."</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> pd.errors.ParserError:</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Error: There was an issue parsing the CSV file. Check if it's properly formatted."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p><span style="color: green">Dataset information:</span></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of rows: 16138
Number of columns: 114

&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 16138 entries, 0 to 16137
Columns: 114 entries, PUMFID to DDIS_FL
dtypes: int64(114)
memory usage: 14.0 MB

</code></pre>
</div>
<div class="cell-output cell-output-display cell-output-markdown">
<p><span style="color: green">Column names:</span></p>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre>PUMFID CERTLEVP REG_INST REG_RESP PGMCIPAP PGM_P034 PGM_P036 PGM_P100 PGM_P111 PGM_280A PGM_280B PGM_280C PGM_280D PGM_280E PGM_280F PGM_290 PGM_350 PGM_380 PGM_P401 PGM_410 PGM_415 PGM_430 COV_010 COV_070 COV_080 EDU_010 EDU_P020 HLOSINTP STL_010 STL_020 STULOANS STL_030 OWESLGD OWEGVIN STL_080 STL_100A STL_100B STL_100C STL_100D STL_130 STL_150 STL_160B STL_160C STL_160D STL_160E STL_160F STL_160G STL_160H STL_160I STL_160J STL_160L STLP160N SRCFUND STL_170A STL_170B STL_170C STL_170D STL_170E STL_170F STL_170G STL_170H STL_170I STL_170J STL_170L STLP170N RESPP STL_190 DBTOTGRD DBTALGRD DBTOTINT DBTALINT SCHOLARP LMA_010 LFSTATP LMA2_07 LMA3_P01 LFCINDP LFCOCCP LFWFTPTP LMA6_05 LMA6_08 JOBQLEVP JOBQLGRD JOBQLINT LMA6_11 LMA6_12 LMA6_13A LMA6_13B LMA6_13C JOBINCP LMA6_15 AFT_P010 AFT_P020 AFT_P040 AFT_050 AFT_070 AFT_080 AFT_090 BEF_P140 BEF_160 PREVLEVP HLOSGRDP PAR1GRD PAR1INT PAR2GRD PAR2INT GRADAGEP GENDER2 MS_P01 MS_P02 CTZSHIPP VISBMINP PERSINCP DDIS_FL 



<span class="ansi-black-fg ansi-yellow-bg">There are no missing data.</span>
</pre>
</div>
</div>
</div>
</section>
<section id="ngs-questions" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ngs-questions"><span class="header-section-number">3.2</span> NGS Questions</h2>
<div id="aeda0d2d" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Path to the YAML file</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'ngs2020_questions.yaml'</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open and load the YAML file</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        questions <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the loaded question structure</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\033</span><span class="ss">[32m</span><span class="ch">\n</span><span class="ss">PUMFID: </span><span class="ch">\033</span><span class="ss">[0m Public Use Microdata File ID - </span><span class="sc">{</span>questions[<span class="st">"PUMFID"</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Questions (</span><span class="sc">{</span><span class="bu">len</span>(questions)<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">):</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> question <span class="kw">in</span> questions:</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> k <span class="op">==</span> <span class="dv">5</span>:</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>:</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> question <span class="op">!=</span> <span class="st">'PUMFID'</span>:</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\033</span><span class="ss">[32m</span><span class="sc">{</span>question<span class="sc">}</span><span class="ss">: </span><span class="ch">\033</span><span class="ss">[0m </span><span class="sc">{</span>questions[question]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error: File '</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">' not found."</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> yaml.YAMLError <span class="im">as</span> e:</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Error parsing YAML file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg">

PUMFID: </span> Public Use Microdata File ID - Randomly generated record identifier for the PUMF file



Questions (113):



<span class="ansi-green-fg">CERTLEVP: </span> 2020 Program - Level of study - Grouping

<span class="ansi-green-fg">REG_INST: </span> 2020 Program - Region of postsecondary educational institution

<span class="ansi-green-fg">REG_RESP: </span> Time of interview 2023 - Region of primary residence

<span class="ansi-green-fg">PGMCIPAP: </span> 2020 Program - Aggregated CIP 2021

<span class="ansi-green-fg">PGM_P034: </span> 2020 Program - Full-time or part-time student

<span class="ansi-green-fg">PGM_P036: </span> 2020 Program - Reason did not take program full-time

<span class="ansi-green-fg">PGM_P100: </span> Work placement during program

<span class="ansi-green-fg">PGM_P111: </span> Work placement during prog - Description

<span class="ansi-green-fg">PGM_280A: </span> Entrepreneurial skills - Started a business

<span class="ansi-green-fg">PGM_280B: </span> Entrepreneurial skills - Completed courses

<span class="ansi-green-fg">PGM_280C: </span> Entrepreneurial skills - Business plan or pitch competition

<span class="ansi-green-fg">PGM_280D: </span> Entrepreneurial skills - Visited an entrepreneurship centre

<span class="ansi-green-fg">PGM_280E: </span> Entrepreneurial skills - Worked on an entrepreneurship project

<span class="ansi-green-fg">PGM_280F: </span> Entrepreneurial skills - None of the above

<span class="ansi-green-fg">PGM_290: </span> 2020 Program - Worked during program

<span class="ansi-green-fg">PGM_350: </span> 2020 Program - Volunteer activities during program

<span class="ansi-green-fg">PGM_380: </span> 2020 Program - Components taken outside of Canada

<span class="ansi-green-fg">PGM_P401: </span> 2020 Program - Online or distance education

<span class="ansi-green-fg">PGM_410: </span> 2020 Program - Main factor in choice of postsecondary institution

<span class="ansi-green-fg">PGM_415: </span> 2020 Program - Main factor in choice of program

<span class="ansi-green-fg">PGM_430: </span> 2020 Program - Choose the same field of study or specialization again

<span class="ansi-green-fg">COV_010: </span> COVID-19 - Completion of program delayed

<span class="ansi-green-fg">COV_070: </span> COVID-19 - Plans for further postsecondary education changed

<span class="ansi-green-fg">COV_080: </span> COVID-19 - Employment status/plans affected

<span class="ansi-green-fg">EDU_010: </span> After 2020 program - Other postsecondary programs taken

<span class="ansi-green-fg">EDU_P020: </span> After 2020 program - Number of other programs taken

<span class="ansi-green-fg">HLOSINTP: </span> Time of interview 2023 - Aggregated highest level of ed. completed

<span class="ansi-green-fg">STL_010: </span> Government-student loan program - Applied

<span class="ansi-green-fg">STL_020: </span> Government-student loan program - Applications approved

<span class="ansi-green-fg">STULOANS: </span> Government-student loan program - Received

<span class="ansi-green-fg">STL_030: </span> Government-student loan program - Main reason did not apply

<span class="ansi-green-fg">OWESLGD: </span> Government-student loan program - Debt size - Graduation 2020

<span class="ansi-green-fg">OWEGVIN: </span> Government-student loan program - Debt size - Interview 2023

<span class="ansi-green-fg">STL_080: </span> Government-student loan program - Remission/debt reduction/loan forg.

<span class="ansi-green-fg">STL_100A: </span> Received government assistance: Repayment assistance plan

<span class="ansi-green-fg">STL_100B: </span> Received government assistance: Revision of terms

<span class="ansi-green-fg">STL_100C: </span> Received government assistance: Interest only payments

<span class="ansi-green-fg">STL_100D: </span> Received government assistance: None of the above

<span class="ansi-green-fg">STL_130: </span> Government-student loan program - Total repayment term

<span class="ansi-green-fg">STL_150: </span> Government-student loan program - Repaymt of loan from financial inst.

<span class="ansi-green-fg">STL_160B: </span> Sources of funding - RESP

<span class="ansi-green-fg">STL_160C: </span> Sources of funding - Government grants or bursaries

<span class="ansi-green-fg">STL_160D: </span> Sources of funding - Non-government grants or bursaries

<span class="ansi-green-fg">STL_160E: </span> Sources of funding - Scholarships or awards

<span class="ansi-green-fg">STL_160F: </span> Sources of funding - Employment earnings or savings

<span class="ansi-green-fg">STL_160G: </span> Sources of funding - Research or teaching assistantship

<span class="ansi-green-fg">STL_160H: </span> Sources of funding - Parents, family, friends

<span class="ansi-green-fg">STL_160I: </span> Sources of funding - Bank or institution loans

<span class="ansi-green-fg">STL_160J: </span> Sources of funding - Credit cards

<span class="ansi-green-fg">STL_160L: </span> Sources of funding - Employer

<span class="ansi-green-fg">STLP160N: </span> Sources of funding - Other

<span class="ansi-green-fg">SRCFUND: </span> Sources of funding - Number of sources  - All postsecondary edu

<span class="ansi-green-fg">STL_170A: </span> Main source of funding - Government student loans

<span class="ansi-green-fg">STL_170B: </span> Main source of funding - RESP

<span class="ansi-green-fg">STL_170C: </span> Main source of funding - Government grants or bursaries

<span class="ansi-green-fg">STL_170D: </span> Main source of funding - Non-government grants or bursaries

<span class="ansi-green-fg">STL_170E: </span> Main source of funding - Scholarships or awards

<span class="ansi-green-fg">STL_170F: </span> Main source of funding - Employment earnings or savings

<span class="ansi-green-fg">STL_170G: </span> Main source of funding - Research or teaching assistantship

<span class="ansi-green-fg">STL_170H: </span> Main source of funding - Parents, family, friends

<span class="ansi-green-fg">STL_170I: </span> Main source of funding - Bank or institution loans

<span class="ansi-green-fg">STL_170J: </span> Main source of funding - Credit cards

<span class="ansi-green-fg">STL_170L: </span> Main source of funding - Employer

<span class="ansi-green-fg">STLP170N: </span> Main source of funding - Other

<span class="ansi-green-fg">RESPP: </span> RESP - Total amount received for postsecondary education

<span class="ansi-green-fg">STL_190: </span> Repay loans from family or friends for education

<span class="ansi-green-fg">DBTOTGRD: </span> Loans at graduation 2020 - Debt size of non-government loans (range)

<span class="ansi-green-fg">DBTALGRD: </span> Loans at graduation 2020 - Debt size of all loans

<span class="ansi-green-fg">DBTOTINT: </span> Time of interview 2023 - Debt size of non-government loans (range)

<span class="ansi-green-fg">DBTALINT: </span> Time of interview 2023 - Debt size of all loan

<span class="ansi-green-fg">SCHOLARP: </span> Total amount received from scholarships/awards/fellowships and prizes

<span class="ansi-green-fg">LMA_010: </span> Reference week - Attended school, college, CEGEP or university

<span class="ansi-green-fg">LFSTATP: </span> Reference week - Labour force status

<span class="ansi-green-fg">LMA2_07: </span> Reference week - More than one job or business

<span class="ansi-green-fg">LMA3_P01: </span> Reference week - Employee or self-employed

<span class="ansi-green-fg">LFCINDP: </span> Reference week - Sector for job

<span class="ansi-green-fg">LFCOCCP: </span> Reference week - Broad occupational category for job

<span class="ansi-green-fg">LFWFTPTP: </span> Reference week - Full-time or part-time status of job or business

<span class="ansi-green-fg">LMA6_05: </span> Reference week - Job permanent or not permanent

<span class="ansi-green-fg">LMA6_08: </span> Reference week - Main method used to find job

<span class="ansi-green-fg">JOBQLEVP: </span> Reference week - Aggregated level of studies required to get job

<span class="ansi-green-fg">JOBQLGRD: </span> Reference week - Qualification for job compared to 2020 program

<span class="ansi-green-fg">JOBQLINT: </span> Reference week - Qualification job vs level of education

<span class="ansi-green-fg">LMA6_11: </span> Reference week - Relatedness of job or business to 2020 program

<span class="ansi-green-fg">LMA6_12: </span> Reference week - Qualification level for job

<span class="ansi-green-fg">LMA6_13A: </span> Reference week - Satisfied with overall job

<span class="ansi-green-fg">LMA6_13B: </span> Reference week - Satisfied with wage or salary of job

<span class="ansi-green-fg">LMA6_13C: </span> Reference week - Satisfied with job security

<span class="ansi-green-fg">JOBINCP: </span> Reference week - Annual wage or salary for job

<span class="ansi-green-fg">LMA6_15: </span> After program 2020 - First job

<span class="ansi-green-fg">AFT_P010: </span> After 2020 program - Number of jobs or businesses

<span class="ansi-green-fg">AFT_P020: </span> After 2020 Program - Length of time until first job or business

<span class="ansi-green-fg">AFT_P040: </span> After 2020 program - Employee or self-employed - 1st job or business

<span class="ansi-green-fg">AFT_050: </span> After 2020 program - Full-time or part-time - 1st job or business

<span class="ansi-green-fg">AFT_070: </span> After 2020 program - Permanent/not permanent  - 1st job or business

<span class="ansi-green-fg">AFT_080: </span> After 2020 program - Reason job not permanent  - 1st job or business

<span class="ansi-green-fg">AFT_090: </span> After 2020 program - Relatedness of 1st job/business to program

<span class="ansi-green-fg">BEF_P140: </span> Before 2020 Program - Main activity during 12 months before

<span class="ansi-green-fg">BEF_160: </span> Before 2020 program - Number of months of work experience

<span class="ansi-green-fg">PREVLEVP: </span> Before 2020 program - Aggregated highest level of studies completed

<span class="ansi-green-fg">HLOSGRDP: </span> 2020 Program - Highest level of education completed

<span class="ansi-green-fg">PAR1GRD: </span> 2020 Program - Level of education compared to that of one parent

<span class="ansi-green-fg">PAR1INT: </span> Time of interview 2023 - Level of education vs of one parent

<span class="ansi-green-fg">PAR2GRD: </span> 2020 Program - Level of education vs of the other parent

<span class="ansi-green-fg">PAR2INT: </span> Time of interview 2023 - Level of education vs that of other parent

<span class="ansi-green-fg">GRADAGEP: </span> 2020 Program - Age at time of graduation - Grouping

<span class="ansi-green-fg">GENDER2: </span> Gender after distribution of non-binary persons

<span class="ansi-green-fg">MS_P01: </span> Marital status

<span class="ansi-green-fg">MS_P02: </span> Have any dependent children

<span class="ansi-green-fg">CTZSHIPP: </span> Time of interview 2023 - Status in Canada

<span class="ansi-green-fg">VISBMINP: </span> Self-identified as a member of a visible minority group

<span class="ansi-green-fg">PERSINCP: </span> Total personal income in 2022

<span class="ansi-green-fg">DDIS_FL: </span> Disability status
</pre>
</div>
</div>
</div>
</section>
<section id="response-code" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="response-code"><span class="header-section-number">3.3</span> Response code</h2>
<div id="0fee2c76" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the yaml module</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file exists before attempting to load it</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"ngs2020_responses.yaml"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(file_path):</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Open and load the YAML file</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Load the YAML content into a Python object (typically a dictionary)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            responses <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Print the first few items to verify the responses loaded correctly</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            display(Markdown(<span class="ss">f"&lt;span style='color: green'&gt;Response code defination (</span><span class="sc">{</span><span class="bu">len</span>(responses)<span class="sc">}</span><span class="ss">):&lt;/span&gt;"</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            k <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> response <span class="kw">in</span> responses:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> k <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span>  <span class="co"># print out 10 only</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'</span><span class="ch">\033</span><span class="ss">[32m</span><span class="sc">{</span>response<span class="sc">}</span><span class="ss">:</span><span class="ch">\033</span><span class="ss">[0m'</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> code <span class="kw">in</span> responses[response]:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f'  </span><span class="ch">\033</span><span class="ss">[32m</span><span class="sc">{</span>code<span class="sc">}</span><span class="ss">: </span><span class="ch">\033</span><span class="ss">[0m</span><span class="sc">{</span>responses[response][code]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                k <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> yaml.YAMLError <span class="im">as</span> e:</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error parsing YAML file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"File not found: </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Please make sure the file exists in the current working directory."</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Current working directory: </span><span class="sc">{</span>os<span class="sc">.</span>getcwd()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display cell-output-markdown">
<p><span style="color: green">Response code defination (113):</span></p>
</div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg">AFT_050:</span>

  <span class="ansi-green-fg">1: </span>Full time

  <span class="ansi-green-fg">2: </span>Part time

  <span class="ansi-green-fg">6: </span>Valid skip

  <span class="ansi-green-fg">7: </span>Don't know

  <span class="ansi-green-fg">8: </span>Refusal

  <span class="ansi-green-fg">9: </span>Not stated

<span class="ansi-green-fg">AFT_070:</span>

  <span class="ansi-green-fg">1: </span>Permanent

  <span class="ansi-green-fg">2: </span>Not permanent

  <span class="ansi-green-fg">6: </span>Valid skip

  <span class="ansi-green-fg">7: </span>Don't know

  <span class="ansi-green-fg">8: </span>Refusal

  <span class="ansi-green-fg">9: </span>Not stated

<span class="ansi-green-fg">AFT_080:</span>

  <span class="ansi-green-fg">1: </span>Seasonal job

  <span class="ansi-green-fg">2: </span>Temporary, term or contract job

  <span class="ansi-green-fg">3: </span>Casual job

  <span class="ansi-green-fg">4: </span>Other

  <span class="ansi-green-fg">6: </span>Valid skip

  <span class="ansi-green-fg">7: </span>Don't know

  <span class="ansi-green-fg">8: </span>Refusal

  <span class="ansi-green-fg">9: </span>Not stated

<span class="ansi-green-fg">AFT_090:</span>

  <span class="ansi-green-fg">1: </span>Closely related

  <span class="ansi-green-fg">2: </span>Somewhat related

  <span class="ansi-green-fg">3: </span>Not at all related

  <span class="ansi-green-fg">6: </span>Valid skip

  <span class="ansi-green-fg">7: </span>Don't know

  <span class="ansi-green-fg">8: </span>Refusal

  <span class="ansi-green-fg">9: </span>Not stated
</pre>
</div>
</div>
</div>
</section>
</section>
<section id="extract-all-ngs-tables-to-excel" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Extract All NGS Tables to Excel</h1>
<div id="ab4d7948" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %run Extract_All_NGS_Tables_to_Excel.ipynb`</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All tables saved to NGS_Tables.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All tables saved to NGS_Tables.xlsx</code></pre>
</div>
</div>
<section id="function-for-getting-ngs-table" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="function-for-getting-ngs-table"><span class="header-section-number">4.1</span> Function for getting NGS table</h2>
<div id="358fe494" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get NGS table</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_NGS_table(table_name <span class="op">=</span> <span class="st">'AFT_050'</span>, excel_file<span class="op">=</span><span class="st">"NGS_Tables.xlsx"</span>):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read the Excel sheet into a DataFrame, using first row as headers</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_excel(excel_file, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                          sheet_name<span class="op">=</span>table_name, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                          header<span class="op">=</span><span class="dv">0</span>)  <span class="co"># header=0 is default but making it explicit</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">'</span><span class="ch">\033</span><span class="ss">[32m</span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ch">\033</span><span class="ss">[0m': </span><span class="sc">{</span>questions[table_name]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        df</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error loading table </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="dashboard" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Dashboard</h1>
<p>A web-based tool for exploring and visualizing data from the NGS2020 database.</p>
<section id="interactive-table-explorer" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="interactive-table-explorer"><span class="header-section-number">5.1</span> Interactive Table Explorer</h2>
<ul>
<li>Searchable list of database tables with descriptions</li>
<li>Shows available tables (<code>{ available_count }</code>) and missing tables</li>
<li>Table preview with sorting capabilities</li>
</ul>
</section>
<section id="data-analysis-features" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="data-analysis-features"><span class="header-section-number">5.2</span> Data Analysis Features</h2>
<section id="statistical-summaries" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="statistical-summaries"><span class="header-section-number">5.2.1</span> Statistical Summaries</h3>
<ul>
<li>Mean, median, min, max, std dev, count</li>
</ul>
</section>
<section id="automated-visualizations" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="automated-visualizations"><span class="header-section-number">5.2.2</span> Automated Visualizations</h3>
<ul>
<li>Pie/Donut charts<br>
</li>
<li>Bar charts<br>
</li>
<li>Box plots<br>
</li>
<li>Histograms<br>
</li>
<li>Weighted frequency analysis</li>
</ul>
</section>
</section>
<section id="technical-implementation" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="technical-implementation"><span class="header-section-number">5.3</span> Technical Implementation</h2>
<ul>
<li><strong>Frontend</strong>: Bootstrap 5 UI with Plotly.js visualizations</li>
<li><strong>Backend</strong>: Flask server with pandas/seaborn/matplotlib</li>
<li><strong>Data Sources</strong>:
<ul>
<li><code>NGS_Tables_Sorted.xlsx</code></li>
<li><code>ngs2020_questions.yaml</code></li>
</ul></li>
</ul>
</section>
<section id="key-functionality" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="key-functionality"><span class="header-section-number">5.4</span> Key Functionality</h2>
<ul>
<li>Dynamic filtering/search of tables</li>
<li>Auto-generated statistics for numeric columns</li>
<li>Visualizations tailored to data types</li>
<li>Error handling for missing/invalid data</li>
<li>Responsive design for different devices</li>
</ul>
</section>
<section id="visual-design" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="visual-design"><span class="header-section-number">5.5</span> Visual Design</h2>
<ul>
<li>Professional blue-gradient background with animated effects</li>
<li>Card-based layout with hover animations</li>
<li>Data tables with striped rows and gradient headers</li>
<li>Vibrant visualization color schemes</li>
</ul>
<hr>
<p>The dashboard provides researchers with an intuitive interface to explore NGS2020 survey data through both numerical summaries and visual representations, with special handling for weighted frequency distributions.</p>
</section>
<section id="dashboard-app-http127.0.0.15000" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="dashboard-app-http127.0.0.15000"><span class="header-section-number">5.6</span> Dashboard App <a href="http://127.0.0.1:5000" class="uri">http://127.0.0.1:5000</a></h2>
</section>
</section>
<section id="data-analysis-predictive-modeling" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Data Analysis &amp; Predictive Modeling</h1>
<section id="employment-status-binary-classiffication" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="employment-status-binary-classiffication"><span class="header-section-number">6.1</span> Employment Status (Binary Classiffication)</h2>
<div id="7c4618d6" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score, StratifiedKFold</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectKBest, f_classif, RFE, VarianceThreshold</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, precision_recall_curve, auc</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils.class_weight <span class="im">import</span> compute_class_weight</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out the specific warnings</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, module<span class="op">=</span><span class="st">"sklearn.feature_selection._univariate_selection"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">RuntimeWarning</span>, module<span class="op">=</span><span class="st">"sklearn.feature_selection._univariate_selection"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Set professional style with a modern color palette</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'default'</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">"husl"</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">8</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titlesize'</span>] <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.labelsize'</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'xtick.labelsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'ytick.labelsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'legend.fontsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.titlesize'</span>] <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the YAML files with feature descriptions and response codes</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_feature_descriptions(file_path<span class="op">=</span><span class="st">'ngs2020_questions.yaml'</span>):</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            questions <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> questions</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: File '</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">' not found."</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> yaml.YAMLError <span class="im">as</span> e:</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error parsing YAML file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_response_codes(file_path<span class="op">=</span><span class="st">'ngs2020_responses.yaml'</span>):</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>            responses <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> responses</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: File '</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">' not found."</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> yaml.YAMLError <span class="im">as</span> e:</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error parsing YAML file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Load feature descriptions and response codes</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>feature_descriptions <span class="op">=</span> load_feature_descriptions()</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>response_codes <span class="op">=</span> load_response_codes()</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get human-readable feature names</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_feature_name(feature_code):</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature_descriptions.get(feature_code, feature_code)</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get human-readable response values</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_response_value(feature_code, value):</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_code <span class="kw">in</span> response_codes <span class="kw">and</span> <span class="bu">str</span>(value) <span class="kw">in</span> response_codes[feature_code]:</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response_codes[feature_code][<span class="bu">str</span>(value)]</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to map a series to human-readable values</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_series_to_readable(series, feature_code):</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_code <span class="kw">in</span> response_codes:</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        mapping <span class="op">=</span> response_codes[feature_code]</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> series.<span class="bu">map</span>(<span class="kw">lambda</span> x: mapping.get(<span class="bu">str</span>(x), x))</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get readable labels for plotting</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_readable_labels(feature_code, values):</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_code <span class="kw">in</span> response_codes:</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [response_codes[feature_code].get(<span class="bu">str</span>(val), <span class="bu">str</span>(val)) <span class="cf">for</span> val <span class="kw">in</span> values]</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="bu">str</span>(val) <span class="cf">for</span> val <span class="kw">in</span> values]</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the actual data</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'ngs2020.csv'</span>)</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Print available columns to help debug</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Available columns in dataset:"</span>)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns.tolist())</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Define missing value codes based on the data documentation</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>missing_codes <span class="op">=</span> [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">96</span>, <span class="dv">97</span>, <span class="dv">98</span>, <span class="dv">99</span>]</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to visualize missing data</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_missing_data(df):</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>    missing <span class="op">=</span> df.isin(missing_codes).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    missing <span class="op">=</span> missing[missing <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    missing.sort_values(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use human-readable feature names</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>    missing.index <span class="op">=</span> [get_feature_name(col) <span class="cf">for</span> col <span class="kw">in</span> missing.index]</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create visualization</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">19</span>))</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> plt.cm.viridis(np.linspace(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(missing)))</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(missing.index, missing.values, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value annotations on bars</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>        ax.text(width <span class="op">+</span> <span class="fl">0.5</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>width<span class="sc">:.1f}</span><span class="ss">%'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Percentage (%)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Column Name'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Percentage of Missing/Special Values by Column'</span>, </span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>                 fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>    ax.spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a subtle background</span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>    ax.set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>plot_missing_data(df)</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Data cleaning - replace missing codes with NaN</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Special handling for VISBMINP and GRADAGEP to preserve category 9 as a valid response</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>preserve_codes <span class="op">=</span> {<span class="st">'VISBMINP'</span>: [<span class="dv">9</span>], <span class="st">'GRADAGEP'</span>: [<span class="dv">9</span>]}  <span class="co"># Codes to keep as-is for specific variables</span></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't apply missing code replacement to the program column</span></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>columns_to_clean <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'PGMCIPAP'</span>]</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columns_to_clean:</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df[col].dtype <span class="kw">in</span> [<span class="st">'int64'</span>, <span class="st">'float64'</span>]:</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> preserve_codes:</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For variables with preserved codes, only replace codes not in the preserve list</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>            codes_to_replace <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> missing_codes <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> preserve_codes[col]]</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>            df[col] <span class="op">=</span> df[col].replace(codes_to_replace, np.nan)</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For all other variables, replace all missing codes</span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>            df[col] <span class="op">=</span> df[col].replace(missing_codes, np.nan)</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a><span class="co"># For the program column, only replace the actual missing codes (96, 97, 98, 99)</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'PGMCIPAP'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'PGMCIPAP'</span>] <span class="op">=</span> df[<span class="st">'PGMCIPAP'</span>].replace([<span class="dv">96</span>, <span class="dv">97</span>, <span class="dv">98</span>, <span class="dv">99</span>], np.nan)</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Employment Status Analysis</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> employment_analysis(df):</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Employment Status Analysis ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'LFSTATP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Employment status data not available."</span>)</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a figure for employment status plots</span></span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color palette</span></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> sns.color_palette(<span class="st">"husl"</span>, <span class="dv">8</span>)</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Employment status distribution</span></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure we include all expected categories</span></span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>    employment_counts <span class="op">=</span> df[<span class="st">'LFSTATP'</span>].value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>    employment_labels <span class="op">=</span> get_readable_labels(<span class="st">'LFSTATP'</span>, employment_counts.index)</span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>get_feature_name(<span class="st">'LFSTATP'</span>)<span class="sc">}</span><span class="ss"> Distribution:"</span>)</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label, count <span class="kw">in</span> <span class="bu">zip</span>(employment_labels, employment_counts):</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create pie chart for employment status</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>    explode <span class="op">=</span> [<span class="fl">0.05</span>] <span class="op">*</span> <span class="bu">len</span>(employment_counts)  <span class="co"># explode slices for emphasis</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>    wedges, texts, autotexts <span class="op">=</span> axes[<span class="dv">0</span>].pie(employment_counts, labels<span class="op">=</span>employment_labels, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>,</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>                                          colors<span class="op">=</span>colors[:<span class="bu">len</span>(employment_counts)], startangle<span class="op">=</span><span class="dv">90</span>, explode<span class="op">=</span>explode,</span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>                                          shadow<span class="op">=</span><span class="va">True</span>, textprops<span class="op">=</span>{<span class="st">'fontsize'</span>: <span class="dv">10</span>})</span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Style the pie chart</span></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> autotext <span class="kw">in</span> autotexts:</span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>        autotext.set_color(<span class="st">'white'</span>)</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>        autotext.set_fontweight(<span class="st">'bold'</span>)</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>        autotext.set_fontsize(<span class="dv">10</span>)</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(<span class="ss">f'</span><span class="sc">{</span>get_feature_name(<span class="st">"LFSTATP"</span>)<span class="sc">}</span><span class="ss"> Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].axis(<span class="st">'equal'</span>)  <span class="co"># Equal aspect ratio ensures that pie is drawn as a circle</span></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Employment status by education level</span></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'CERTLEVP'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create cross-tabulation</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>        emp_by_edu <span class="op">=</span> pd.crosstab(df[<span class="st">'CERTLEVP'</span>], df[<span class="st">'LFSTATP'</span>])</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert to percentages</span></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>        emp_by_edu_pct <span class="op">=</span> emp_by_edu.div(emp_by_edu.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get readable labels</span></span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>        edu_labels <span class="op">=</span> get_readable_labels(<span class="st">'CERTLEVP'</span>, emp_by_edu_pct.index)</span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>        emp_labels <span class="op">=</span> get_readable_labels(<span class="st">'LFSTATP'</span>, emp_by_edu_pct.columns)</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create stacked bar chart</span></span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>        bottom <span class="op">=</span> np.zeros(<span class="bu">len</span>(edu_labels))</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, emp_status <span class="kw">in</span> <span class="bu">enumerate</span>(emp_by_edu_pct.columns):</span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>            axes[<span class="dv">1</span>].bar(edu_labels, emp_by_edu_pct[emp_status], bottom<span class="op">=</span>bottom, </span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>                       label<span class="op">=</span>emp_labels[i], color<span class="op">=</span>colors[i], alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>            bottom <span class="op">+=</span> emp_by_edu_pct[emp_status]</span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_title(<span class="st">'Employment Status by Education Level'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Percentage (%)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add grid</span></span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove spines</span></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Education level data (CERTLEVP) not available for employment analysis."</span>)</span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background color to the figure</span></span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a>    fig.patch.set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>employment_analysis(df)</span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Analysis with Employment Focus</span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correlation_analysis(df):</span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Correlation Analysis ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select columns that might have meaningful correlations with employment</span></span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>    corr_cols <span class="op">=</span> [</span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>        <span class="st">'GRADAGEP'</span>, </span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>        <span class="st">'PERSINCP'</span>, </span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>        <span class="st">'JOBINCP'</span>,  </span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>        <span class="st">'STULOANS'</span>, </span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>        <span class="st">'LFSTATP'</span>,  </span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CERTLEVP'</span>,</span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add additional columns if they exist</span></span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>    optional_cols <span class="op">=</span> [<span class="st">'LFCINDP'</span>, <span class="st">'LFCOCCP'</span>, <span class="st">'COV_010'</span>]</span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> optional_cols:</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>            corr_cols.append(col)</span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to only include columns that exist in the dataset</span></span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>    corr_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> corr_cols <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(corr_cols) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Not enough columns for correlation analysis."</span>)</span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>    corr_df <span class="op">=</span> df[corr_cols].copy()</span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out missing codes</span></span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> corr_cols:</span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a>        corr_df <span class="op">=</span> corr_df[<span class="op">~</span>corr_df[col].isin(missing_codes)]</span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute correlation matrix</span></span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a>    corr_matrix <span class="op">=</span> corr_df.corr()</span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get human-readable labels</span></span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a>    human_labels <span class="op">=</span> [get_feature_name(col) <span class="cf">for</span> col <span class="kw">in</span> corr_cols]</span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot heatmap</span></span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a mask for the upper triangle</span></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.triu(np.ones_like(corr_matrix, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create heatmap with mask</span></span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>    heatmap <span class="op">=</span> sns.heatmap(</span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>        corr_matrix,</span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>        annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">'RdBu_r'</span>,</span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a>        center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">=</span><span class="st">".2f"</span>,</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>        square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>        mask<span class="op">=</span>mask,</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>        cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>        annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">11</span>, <span class="st">"weight"</span>: <span class="st">"bold"</span>},</span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>        linewidths<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>        linecolor<span class="op">=</span><span class="st">'white'</span></span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set title</span></span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Correlation Matrix of Key Variables (Employment Focus)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set x-axis labels with rotation</span></span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>    heatmap.set_xticklabels(human_labels, rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set y-axis labels with proper rotation and alignment</span></span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>    heatmap.set_yticklabels(human_labels, rotation<span class="op">=</span><span class="dv">0</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background</span></span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a>correlation_analysis(df)</span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Define potential features for employment prediction modeling</span></span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a>potential_features <span class="op">=</span> [</span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GENDER2'</span>, <span class="st">'CERTLEVP'</span>, <span class="st">'PERSINCP'</span>, <span class="st">'GRADAGEP'</span>,</span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a>    <span class="st">'VISBMINP'</span>, <span class="st">'CTZSHIPP'</span>, <span class="st">'MS_P01'</span>, <span class="st">'REG_INST'</span>, <span class="st">'EDU_010'</span>,</span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PGMCIPAP'</span>, <span class="st">'STULOANS'</span>, <span class="st">'JOBINCP'</span></span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Add optional features if they exist in the dataset</span></span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a>optional_features <span class="op">=</span> [<span class="st">'LFCINDP'</span>, <span class="st">'LFCOCCP'</span>, <span class="st">'LMA6_11'</span>, <span class="st">'COV_010'</span>, <span class="st">'LMA_010'</span>, <span class="st">'LMA_020'</span>, <span class="st">'LMA_030'</span>]</span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature <span class="kw">in</span> optional_features:</span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature <span class="kw">in</span> df.columns:</span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a>        potential_features.append(feature)</span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to only include columns that exist in the dataset</span></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a>potential_features <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> potential_features <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Using the following features for modeling: </span><span class="sc">{</span>potential_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictive Modeling with Feature Selection for Employment</span></span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_employment(df, features):</span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Predictive Modeling: Employment Status Prediction ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'LFSTATP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Employment status (LFSTATP) not available for modeling."</span>)</span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove job-related features that are 100% missing for unemployed individuals</span></span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a>    job_features_to_remove <span class="op">=</span> [<span class="st">'JOBINCP'</span>, <span class="st">'LFCINDP'</span>, <span class="st">'LFCOCCP'</span>, <span class="st">'LMA6_11'</span>]</span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">not</span> <span class="kw">in</span> job_features_to_remove]</span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Removed job-related features: </span><span class="sc">{</span>job_features_to_remove<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Using features: </span><span class="sc">{</span>[get_feature_name(f) <span class="cf">for</span> f <span class="kw">in</span> features]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data with potential features</span></span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>    model_df <span class="op">=</span> df[features <span class="op">+</span> [<span class="st">'LFSTATP'</span>]].copy()</span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace missing codes with NaN</span></span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> model_df.columns:</span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_df[col].dtype <span class="kw">in</span> [<span class="st">'int64'</span>, <span class="st">'float64'</span>]:</span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> preserve_codes:</span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>                codes_to_replace <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> missing_codes <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> preserve_codes[col]]</span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>                model_df[col] <span class="op">=</span> model_df[col].replace(codes_to_replace, np.nan)</span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>                model_df[col] <span class="op">=</span> model_df[col].replace(missing_codes, np.nan)</span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for employed and unemployed only</span></span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a>    model_df <span class="op">=</span> model_df[model_df[<span class="st">'LFSTATP'</span>].isin([<span class="dv">1</span>, <span class="dv">2</span>])]</span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop rows with missing values</span></span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a>    model_df <span class="op">=</span> model_df.dropna()</span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check class distribution</span></span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a>    class_counts <span class="op">=</span> model_df[<span class="st">'LFSTATP'</span>].value_counts()</span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Class distribution after processing: </span><span class="sc">{</span><span class="bu">dict</span>(class_counts)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(class_counts) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Warning: Still only one class after removing job-related features."</span>)</span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"This suggests other features are still causing issues."</span>)</span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(model_df) <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Not enough data for modeling. Only </span><span class="sc">{</span><span class="bu">len</span>(model_df)<span class="sc">}</span><span class="ss"> samples available."</span>)</span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert categorical variables to numerical</span></span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a>    le <span class="op">=</span> LabelEncoder()</span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> features:</span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_df[col].dtype <span class="op">==</span> <span class="st">'object'</span>:</span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a>            model_df[col] <span class="op">=</span> le.fit_transform(model_df[col])</span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split data with stratification</span></span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> model_df.drop(<span class="st">'LFSTATP'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> model_df[<span class="st">'LFSTATP'</span>]</span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a>        X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove constant features</span></span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a>    selector <span class="op">=</span> VarianceThreshold()</span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a>    X_train_clean <span class="op">=</span> selector.fit_transform(X_train)</span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a>    X_test_clean <span class="op">=</span> selector.transform(X_test)</span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the feature names after removing constant features</span></span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a>    selected_features <span class="op">=</span> X.columns[selector.get_support()]</span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> pd.DataFrame(X_train_clean, columns<span class="op">=</span>selected_features)</span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> pd.DataFrame(X_test_clean, columns<span class="op">=</span>selected_features)</span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(selected_features) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No features remaining after variance threshold. Cannot proceed with modeling."</span>)</span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate class weights for imbalanced data</span></span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a>    classes <span class="op">=</span> np.unique(y_train)</span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a>    class_weights <span class="op">=</span> compute_class_weight(<span class="st">'balanced'</span>, classes<span class="op">=</span>classes, y<span class="op">=</span>y_train)</span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a>    class_weight_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(classes, class_weights))</span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Class weights: </span><span class="sc">{</span>class_weight_dict<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply SMOTE to balance the training data</span></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a>    smote <span class="op">=</span> SMOTE(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a>    X_train_res, y_train_res <span class="op">=</span> smote.fit_resample(X_train, y_train)</span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"After SMOTE - Class distribution: </span><span class="sc">{</span>np<span class="sc">.</span>bincount(y_train_res)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature Selection Methods (using resampled data)</span></span>
<span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method 1: SelectKBest with ANOVA F-value</span></span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"1. SelectKBest Feature Selection:"</span>)</span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(selected_features))</span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a>    selector_kbest <span class="op">=</span> SelectKBest(score_func<span class="op">=</span>f_classif, k<span class="op">=</span>k)</span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a>    X_kbest <span class="op">=</span> selector_kbest.fit_transform(X_train_res, y_train_res)</span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a>    selected_features_kbest <span class="op">=</span> selected_features[selector_kbest.get_support()]</span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a>    selected_features_kbest_desc <span class="op">=</span> [get_feature_name(feat) <span class="cf">for</span> feat <span class="kw">in</span> selected_features_kbest]</span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Selected features: </span><span class="sc">{</span>selected_features_kbest_desc<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method 2: Recursive Feature Elimination (RFE)</span></span>
<span id="cb8-428"><a href="#cb8-428" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. Recursive Feature Elimination (RFE):"</span>)</span>
<span id="cb8-429"><a href="#cb8-429" aria-hidden="true" tabindex="-1"></a>    estimator <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>, max_iter<span class="op">=</span><span class="dv">1000</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)</span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a>    n_features <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(selected_features))</span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a>    selector_rfe <span class="op">=</span> RFE(estimator, n_features_to_select<span class="op">=</span>n_features, step<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-432"><a href="#cb8-432" aria-hidden="true" tabindex="-1"></a>    X_rfe <span class="op">=</span> selector_rfe.fit_transform(X_train_res, y_train_res)</span>
<span id="cb8-433"><a href="#cb8-433" aria-hidden="true" tabindex="-1"></a>    selected_features_rfe <span class="op">=</span> selected_features[selector_rfe.get_support()]</span>
<span id="cb8-434"><a href="#cb8-434" aria-hidden="true" tabindex="-1"></a>    selected_features_rfe_desc <span class="op">=</span> [get_feature_name(feat) <span class="cf">for</span> feat <span class="kw">in</span> selected_features_rfe]</span>
<span id="cb8-435"><a href="#cb8-435" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Selected features: </span><span class="sc">{</span>selected_features_rfe_desc<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-436"><a href="#cb8-436" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-437"><a href="#cb8-437" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method 3: Feature Importance from Random Forest</span></span>
<span id="cb8-438"><a href="#cb8-438" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. Random Forest Feature Importance:"</span>)</span>
<span id="cb8-439"><a href="#cb8-439" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)</span>
<span id="cb8-440"><a href="#cb8-440" aria-hidden="true" tabindex="-1"></a>    rf.fit(X_train_res, y_train_res)</span>
<span id="cb8-441"><a href="#cb8-441" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-442"><a href="#cb8-442" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot feature importance</span></span>
<span id="cb8-443"><a href="#cb8-443" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> pd.Series(rf.feature_importances_, index<span class="op">=</span>selected_features)</span>
<span id="cb8-444"><a href="#cb8-444" aria-hidden="true" tabindex="-1"></a>    importance.index <span class="op">=</span> [get_feature_name(feat) <span class="cf">for</span> feat <span class="kw">in</span> importance.index]</span>
<span id="cb8-445"><a href="#cb8-445" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> importance.sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-446"><a href="#cb8-446" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-447"><a href="#cb8-447" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a horizontal bar chart for feature importance</span></span>
<span id="cb8-448"><a href="#cb8-448" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb8-449"><a href="#cb8-449" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> plt.cm.viridis(np.linspace(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(importance)))</span>
<span id="cb8-450"><a href="#cb8-450" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> plt.barh(importance.index, importance.values, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-451"><a href="#cb8-451" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-452"><a href="#cb8-452" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value annotations on bars</span></span>
<span id="cb8-453"><a href="#cb8-453" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb8-454"><a href="#cb8-454" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb8-455"><a href="#cb8-455" aria-hidden="true" tabindex="-1"></a>        plt.text(width <span class="op">+</span> <span class="fl">0.001</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb8-456"><a href="#cb8-456" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>width<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb8-457"><a href="#cb8-457" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-458"><a href="#cb8-458" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb8-459"><a href="#cb8-459" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Importance Score'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-460"><a href="#cb8-460" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Features'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-461"><a href="#cb8-461" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Feature Importance for Employment Status Prediction'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-462"><a href="#cb8-462" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-463"><a href="#cb8-463" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb8-464"><a href="#cb8-464" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-465"><a href="#cb8-465" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-466"><a href="#cb8-466" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb8-467"><a href="#cb8-467" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb8-468"><a href="#cb8-468" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-469"><a href="#cb8-469" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background</span></span>
<span id="cb8-470"><a href="#cb8-470" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb8-471"><a href="#cb8-471" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-472"><a href="#cb8-472" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-473"><a href="#cb8-473" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-474"><a href="#cb8-474" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-475"><a href="#cb8-475" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select top 5 features based on importance</span></span>
<span id="cb8-476"><a href="#cb8-476" aria-hidden="true" tabindex="-1"></a>    top_features <span class="op">=</span> importance.nlargest(<span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(importance))).index.tolist()</span>
<span id="cb8-477"><a href="#cb8-477" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Top 5 features: </span><span class="sc">{</span>top_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-478"><a href="#cb8-478" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-479"><a href="#cb8-479" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compare performance with and without feature selection</span></span>
<span id="cb8-480"><a href="#cb8-480" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">4. Model Performance Comparison:"</span>)</span>
<span id="cb8-481"><a href="#cb8-481" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-482"><a href="#cb8-482" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Baseline model (all features)</span></span>
<span id="cb8-483"><a href="#cb8-483" aria-hidden="true" tabindex="-1"></a>    model_all <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)</span>
<span id="cb8-484"><a href="#cb8-484" aria-hidden="true" tabindex="-1"></a>    model_all.fit(X_train_res, y_train_res)</span>
<span id="cb8-485"><a href="#cb8-485" aria-hidden="true" tabindex="-1"></a>    y_pred_all <span class="op">=</span> model_all.predict(X_test)</span>
<span id="cb8-486"><a href="#cb8-486" aria-hidden="true" tabindex="-1"></a>    accuracy_all <span class="op">=</span> model_all.score(X_test, y_test)</span>
<span id="cb8-487"><a href="#cb8-487" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"All features accuracy:"</span>, accuracy_all)</span>
<span id="cb8-488"><a href="#cb8-488" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-489"><a href="#cb8-489" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model with top 5 features from RF importance</span></span>
<span id="cb8-490"><a href="#cb8-490" aria-hidden="true" tabindex="-1"></a>    top_feature_codes <span class="op">=</span> [feat <span class="cf">for</span> feat <span class="kw">in</span> selected_features <span class="cf">if</span> get_feature_name(feat) <span class="kw">in</span> top_features]</span>
<span id="cb8-491"><a href="#cb8-491" aria-hidden="true" tabindex="-1"></a>    X_train_top <span class="op">=</span> X_train_res[top_feature_codes]</span>
<span id="cb8-492"><a href="#cb8-492" aria-hidden="true" tabindex="-1"></a>    X_test_top <span class="op">=</span> X_test[top_feature_codes]</span>
<span id="cb8-493"><a href="#cb8-493" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-494"><a href="#cb8-494" aria-hidden="true" tabindex="-1"></a>    model_top <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)</span>
<span id="cb8-495"><a href="#cb8-495" aria-hidden="true" tabindex="-1"></a>    model_top.fit(X_train_top, y_train_res)</span>
<span id="cb8-496"><a href="#cb8-496" aria-hidden="true" tabindex="-1"></a>    y_pred_top <span class="op">=</span> model_top.predict(X_test_top)</span>
<span id="cb8-497"><a href="#cb8-497" aria-hidden="true" tabindex="-1"></a>    accuracy_top <span class="op">=</span> model_top.score(X_test_top, y_test)</span>
<span id="cb8-498"><a href="#cb8-498" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Top 5 features accuracy:"</span>, accuracy_top)</span>
<span id="cb8-499"><a href="#cb8-499" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-500"><a href="#cb8-500" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model with SelectKBest features</span></span>
<span id="cb8-501"><a href="#cb8-501" aria-hidden="true" tabindex="-1"></a>    X_train_kbest <span class="op">=</span> X_train_res[selected_features_kbest]</span>
<span id="cb8-502"><a href="#cb8-502" aria-hidden="true" tabindex="-1"></a>    X_test_kbest <span class="op">=</span> X_test[selected_features_kbest]</span>
<span id="cb8-503"><a href="#cb8-503" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-504"><a href="#cb8-504" aria-hidden="true" tabindex="-1"></a>    model_kbest <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)</span>
<span id="cb8-505"><a href="#cb8-505" aria-hidden="true" tabindex="-1"></a>    model_kbest.fit(X_train_kbest, y_train_res)</span>
<span id="cb8-506"><a href="#cb8-506" aria-hidden="true" tabindex="-1"></a>    y_pred_kbest <span class="op">=</span> model_kbest.predict(X_test_kbest)</span>
<span id="cb8-507"><a href="#cb8-507" aria-hidden="true" tabindex="-1"></a>    accuracy_kbest <span class="op">=</span> model_kbest.score(X_test_kbest, y_test)</span>
<span id="cb8-508"><a href="#cb8-508" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"SelectKBest features accuracy:"</span>, accuracy_kbest)</span>
<span id="cb8-509"><a href="#cb8-509" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-510"><a href="#cb8-510" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model with RFE features</span></span>
<span id="cb8-511"><a href="#cb8-511" aria-hidden="true" tabindex="-1"></a>    X_train_rfe <span class="op">=</span> X_train_res[selected_features_rfe]</span>
<span id="cb8-512"><a href="#cb8-512" aria-hidden="true" tabindex="-1"></a>    X_test_rfe <span class="op">=</span> X_test[selected_features_rfe]</span>
<span id="cb8-513"><a href="#cb8-513" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-514"><a href="#cb8-514" aria-hidden="true" tabindex="-1"></a>    model_rfe <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>, class_weight<span class="op">=</span><span class="st">'balanced'</span>)</span>
<span id="cb8-515"><a href="#cb8-515" aria-hidden="true" tabindex="-1"></a>    model_rfe.fit(X_train_rfe, y_train_res)</span>
<span id="cb8-516"><a href="#cb8-516" aria-hidden="true" tabindex="-1"></a>    y_pred_rfe <span class="op">=</span> model_rfe.predict(X_test_rfe)</span>
<span id="cb8-517"><a href="#cb8-517" aria-hidden="true" tabindex="-1"></a>    accuracy_rfe <span class="op">=</span> model_rfe.score(X_test_rfe, y_test)</span>
<span id="cb8-518"><a href="#cb8-518" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"RFE features accuracy:"</span>, accuracy_rfe)</span>
<span id="cb8-519"><a href="#cb8-519" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-520"><a href="#cb8-520" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a comparison chart</span></span>
<span id="cb8-521"><a href="#cb8-521" aria-hidden="true" tabindex="-1"></a>    methods <span class="op">=</span> [<span class="st">'All Features'</span>, <span class="st">'Top 5 Features'</span>, <span class="st">'SelectKBest'</span>, <span class="st">'RFE'</span>]</span>
<span id="cb8-522"><a href="#cb8-522" aria-hidden="true" tabindex="-1"></a>    accuracies <span class="op">=</span> [accuracy_all, accuracy_top, accuracy_kbest, accuracy_rfe]</span>
<span id="cb8-523"><a href="#cb8-523" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-524"><a href="#cb8-524" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a comparison bar chart</span></span>
<span id="cb8-525"><a href="#cb8-525" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb8-526"><a href="#cb8-526" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'#1f77b4'</span>, <span class="st">'#ff7f0e'</span>, <span class="st">'#2ca02c'</span>, <span class="st">'#d62728'</span>]</span>
<span id="cb8-527"><a href="#cb8-527" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> plt.bar(methods, accuracies, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-528"><a href="#cb8-528" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-529"><a href="#cb8-529" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value labels on top of bars</span></span>
<span id="cb8-530"><a href="#cb8-530" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb8-531"><a href="#cb8-531" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> bar.get_height()</span>
<span id="cb8-532"><a href="#cb8-532" aria-hidden="true" tabindex="-1"></a>        plt.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height <span class="op">+</span> <span class="fl">0.01</span>,</span>
<span id="cb8-533"><a href="#cb8-533" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>height<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb8-534"><a href="#cb8-534" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-535"><a href="#cb8-535" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb8-536"><a href="#cb8-536" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Accuracy'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-537"><a href="#cb8-537" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Model Accuracy Comparison by Feature Selection Method'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-538"><a href="#cb8-538" aria-hidden="true" tabindex="-1"></a>    plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb8-539"><a href="#cb8-539" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-540"><a href="#cb8-540" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb8-541"><a href="#cb8-541" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-542"><a href="#cb8-542" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-543"><a href="#cb8-543" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb8-544"><a href="#cb8-544" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb8-545"><a href="#cb8-545" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-546"><a href="#cb8-546" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background</span></span>
<span id="cb8-547"><a href="#cb8-547" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb8-548"><a href="#cb8-548" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-549"><a href="#cb8-549" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-550"><a href="#cb8-550" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-551"><a href="#cb8-551" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-552"><a href="#cb8-552" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compare classification reports</span></span>
<span id="cb8-553"><a href="#cb8-553" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report - All Features:"</span>)</span>
<span id="cb8-554"><a href="#cb8-554" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(classification_report(y_test, y_pred_all))</span>
<span id="cb8-555"><a href="#cb8-555" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-556"><a href="#cb8-556" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Classification Report - Top 5 Features:"</span>)</span>
<span id="cb8-557"><a href="#cb8-557" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(classification_report(y_test, y_pred_top))</span>
<span id="cb8-558"><a href="#cb8-558" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-559"><a href="#cb8-559" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create confusion matrix for the best model</span></span>
<span id="cb8-560"><a href="#cb8-560" aria-hidden="true" tabindex="-1"></a>    best_model <span class="op">=</span> model_top  <span class="co"># Using top features model</span></span>
<span id="cb8-561"><a href="#cb8-561" aria-hidden="true" tabindex="-1"></a>    y_pred_best <span class="op">=</span> best_model.predict(X_test_top)</span>
<span id="cb8-562"><a href="#cb8-562" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-563"><a href="#cb8-563" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_test, y_pred_best)</span>
<span id="cb8-564"><a href="#cb8-564" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb8-565"><a href="#cb8-565" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(cm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>, </span>
<span id="cb8-566"><a href="#cb8-566" aria-hidden="true" tabindex="-1"></a>                xticklabels<span class="op">=</span>[<span class="st">'Employed'</span>, <span class="st">'Unemployed'</span>],</span>
<span id="cb8-567"><a href="#cb8-567" aria-hidden="true" tabindex="-1"></a>                yticklabels<span class="op">=</span>[<span class="st">'Employed'</span>, <span class="st">'Unemployed'</span>])</span>
<span id="cb8-568"><a href="#cb8-568" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Confusion Matrix - Employment Prediction'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-569"><a href="#cb8-569" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Actual'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-570"><a href="#cb8-570" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Predicted'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-571"><a href="#cb8-571" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-572"><a href="#cb8-572" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-573"><a href="#cb8-573" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-574"><a href="#cb8-574" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot Precision-Recall curve for the minority class</span></span>
<span id="cb8-575"><a href="#cb8-575" aria-hidden="true" tabindex="-1"></a>    y_prob <span class="op">=</span> best_model.predict_proba(X_test_top)[:, <span class="dv">1</span>]  <span class="co"># Probability for class 2 (unemployed)</span></span>
<span id="cb8-576"><a href="#cb8-576" aria-hidden="true" tabindex="-1"></a>    precision, recall, thresholds <span class="op">=</span> precision_recall_curve(y_test<span class="op">-</span><span class="dv">1</span>, y_prob)  <span class="co"># Convert to 0/1 for sklearn</span></span>
<span id="cb8-577"><a href="#cb8-577" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-578"><a href="#cb8-578" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb8-579"><a href="#cb8-579" aria-hidden="true" tabindex="-1"></a>    plt.plot(recall, precision, marker<span class="op">=</span><span class="st">'.'</span>, label<span class="op">=</span><span class="st">'Random Forest'</span>)</span>
<span id="cb8-580"><a href="#cb8-580" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Recall'</span>)</span>
<span id="cb8-581"><a href="#cb8-581" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Precision'</span>)</span>
<span id="cb8-582"><a href="#cb8-582" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Precision-Recall Curve for Minority Class (Unemployed)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-583"><a href="#cb8-583" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb8-584"><a href="#cb8-584" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-585"><a href="#cb8-585" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate AUC</span></span>
<span id="cb8-586"><a href="#cb8-586" aria-hidden="true" tabindex="-1"></a>    pr_auc <span class="op">=</span> auc(recall, precision)</span>
<span id="cb8-587"><a href="#cb8-587" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Precision-Recall AUC: </span><span class="sc">{</span>pr_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-588"><a href="#cb8-588" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-589"><a href="#cb8-589" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find optimal threshold (maximizing F1-score)</span></span>
<span id="cb8-590"><a href="#cb8-590" aria-hidden="true" tabindex="-1"></a>    f1_scores <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (precision <span class="op">*</span> recall) <span class="op">/</span> (precision <span class="op">+</span> recall <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb8-591"><a href="#cb8-591" aria-hidden="true" tabindex="-1"></a>    optimal_idx <span class="op">=</span> np.argmax(f1_scores)</span>
<span id="cb8-592"><a href="#cb8-592" aria-hidden="true" tabindex="-1"></a>    optimal_threshold <span class="op">=</span> thresholds[optimal_idx]</span>
<span id="cb8-593"><a href="#cb8-593" aria-hidden="true" tabindex="-1"></a>    optimal_precision <span class="op">=</span> precision[optimal_idx]</span>
<span id="cb8-594"><a href="#cb8-594" aria-hidden="true" tabindex="-1"></a>    optimal_recall <span class="op">=</span> recall[optimal_idx]</span>
<span id="cb8-595"><a href="#cb8-595" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-596"><a href="#cb8-596" aria-hidden="true" tabindex="-1"></a>    plt.plot(optimal_recall, optimal_precision, <span class="st">'ro'</span>, markersize<span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb8-597"><a href="#cb8-597" aria-hidden="true" tabindex="-1"></a>             label<span class="op">=</span><span class="ss">f'Optimal Threshold (</span><span class="sc">{</span>optimal_threshold<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb8-598"><a href="#cb8-598" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb8-599"><a href="#cb8-599" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb8-600"><a href="#cb8-600" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-601"><a href="#cb8-601" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-602"><a href="#cb8-602" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Optimal Threshold: </span><span class="sc">{</span>optimal_threshold<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-603"><a href="#cb8-603" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Optimal Precision: </span><span class="sc">{</span>optimal_precision<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-604"><a href="#cb8-604" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Optimal Recall: </span><span class="sc">{</span>optimal_recall<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-605"><a href="#cb8-605" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-606"><a href="#cb8-606" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply optimal threshold</span></span>
<span id="cb8-607"><a href="#cb8-607" aria-hidden="true" tabindex="-1"></a>    y_pred_optimal <span class="op">=</span> (y_prob <span class="op">&gt;=</span> optimal_threshold).astype(<span class="bu">int</span>) <span class="op">+</span> <span class="dv">1</span>  <span class="co"># Convert back to 1/2</span></span>
<span id="cb8-608"><a href="#cb8-608" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-609"><a href="#cb8-609" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report with Optimal Threshold:"</span>)</span>
<span id="cb8-610"><a href="#cb8-610" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(classification_report(y_test, y_pred_optimal))</span>
<span id="cb8-611"><a href="#cb8-611" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-612"><a href="#cb8-612" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add XGBoost model after the Random Forest models</span></span>
<span id="cb8-613"><a href="#cb8-613" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">6. XGBoost Model with Class Weighting:"</span>)</span>
<span id="cb8-614"><a href="#cb8-614" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-615"><a href="#cb8-615" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert labels from [1, 2] to [0, 1] for XGBoost</span></span>
<span id="cb8-616"><a href="#cb8-616" aria-hidden="true" tabindex="-1"></a>    y_train_xgb <span class="op">=</span> y_train_res <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb8-617"><a href="#cb8-617" aria-hidden="true" tabindex="-1"></a>    y_test_xgb <span class="op">=</span> y_test <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb8-618"><a href="#cb8-618" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-619"><a href="#cb8-619" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the ratio for scale_pos_weight</span></span>
<span id="cb8-620"><a href="#cb8-620" aria-hidden="true" tabindex="-1"></a>    count_majority <span class="op">=</span> (y_train <span class="op">==</span> <span class="dv">1</span>).<span class="bu">sum</span>()</span>
<span id="cb8-621"><a href="#cb8-621" aria-hidden="true" tabindex="-1"></a>    count_minority <span class="op">=</span> (y_train <span class="op">==</span> <span class="dv">2</span>).<span class="bu">sum</span>()</span>
<span id="cb8-622"><a href="#cb8-622" aria-hidden="true" tabindex="-1"></a>    ratio <span class="op">=</span> count_majority <span class="op">/</span> count_minority</span>
<span id="cb8-623"><a href="#cb8-623" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Class ratio (majority:minority): </span><span class="sc">{</span>ratio<span class="sc">:.2f}</span><span class="ss">:1"</span>)</span>
<span id="cb8-624"><a href="#cb8-624" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-625"><a href="#cb8-625" aria-hidden="true" tabindex="-1"></a>    <span class="co"># XGBoost model</span></span>
<span id="cb8-626"><a href="#cb8-626" aria-hidden="true" tabindex="-1"></a>    xgb_model <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb8-627"><a href="#cb8-627" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb8-628"><a href="#cb8-628" aria-hidden="true" tabindex="-1"></a>        scale_pos_weight<span class="op">=</span>ratio,</span>
<span id="cb8-629"><a href="#cb8-629" aria-hidden="true" tabindex="-1"></a>        eval_metric<span class="op">=</span><span class="st">'logloss'</span></span>
<span id="cb8-630"><a href="#cb8-630" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-631"><a href="#cb8-631" aria-hidden="true" tabindex="-1"></a>    xgb_model.fit(X_train_res[top_feature_codes], y_train_xgb)</span>
<span id="cb8-632"><a href="#cb8-632" aria-hidden="true" tabindex="-1"></a>    y_pred_xgb <span class="op">=</span> xgb_model.predict(X_test_top)</span>
<span id="cb8-633"><a href="#cb8-633" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-634"><a href="#cb8-634" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert predictions back to original labels [1, 2]</span></span>
<span id="cb8-635"><a href="#cb8-635" aria-hidden="true" tabindex="-1"></a>    y_pred_xgb_original <span class="op">=</span> y_pred_xgb <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb8-636"><a href="#cb8-636" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-637"><a href="#cb8-637" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"XGBoost Classification Report:"</span>)</span>
<span id="cb8-638"><a href="#cb8-638" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(classification_report(y_test, y_pred_xgb_original))</span>
<span id="cb8-639"><a href="#cb8-639" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-640"><a href="#cb8-640" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot XGBoost feature importance</span></span>
<span id="cb8-641"><a href="#cb8-641" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb8-642"><a href="#cb8-642" aria-hidden="true" tabindex="-1"></a>    xgb_importance <span class="op">=</span> pd.Series(xgb_model.feature_importances_, index<span class="op">=</span>top_feature_codes)</span>
<span id="cb8-643"><a href="#cb8-643" aria-hidden="true" tabindex="-1"></a>    xgb_importance.index <span class="op">=</span> [get_feature_name(feat) <span class="cf">for</span> feat <span class="kw">in</span> xgb_importance.index]</span>
<span id="cb8-644"><a href="#cb8-644" aria-hidden="true" tabindex="-1"></a>    xgb_importance <span class="op">=</span> xgb_importance.sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-645"><a href="#cb8-645" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-646"><a href="#cb8-646" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> plt.cm.viridis(np.linspace(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(xgb_importance)))</span>
<span id="cb8-647"><a href="#cb8-647" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> plt.barh(xgb_importance.index, xgb_importance.values, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-648"><a href="#cb8-648" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-649"><a href="#cb8-649" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value annotations on bars</span></span>
<span id="cb8-650"><a href="#cb8-650" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb8-651"><a href="#cb8-651" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb8-652"><a href="#cb8-652" aria-hidden="true" tabindex="-1"></a>        plt.text(width <span class="op">+</span> <span class="fl">0.001</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb8-653"><a href="#cb8-653" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>width<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb8-654"><a href="#cb8-654" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-655"><a href="#cb8-655" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Importance Score'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-656"><a href="#cb8-656" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Features'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb8-657"><a href="#cb8-657" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'XGBoost Feature Importance'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-658"><a href="#cb8-658" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-659"><a href="#cb8-659" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb8-660"><a href="#cb8-660" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb8-661"><a href="#cb8-661" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-662"><a href="#cb8-662" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-663"><a href="#cb8-663" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-664"><a href="#cb8-664" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cross-validation to validate results</span></span>
<span id="cb8-665"><a href="#cb8-665" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">7. Cross-Validation Results:"</span>)</span>
<span id="cb8-666"><a href="#cb8-666" aria-hidden="true" tabindex="-1"></a>    cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb8-667"><a href="#cb8-667" aria-hidden="true" tabindex="-1"></a>    cv_scores <span class="op">=</span> cross_val_score(model_top, X_train_res[top_feature_codes], y_train_res, </span>
<span id="cb8-668"><a href="#cb8-668" aria-hidden="true" tabindex="-1"></a>                               cv<span class="op">=</span>cv, scoring<span class="op">=</span><span class="st">'f1_weighted'</span>)</span>
<span id="cb8-669"><a href="#cb8-669" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Cross-Validation F1 Scores: </span><span class="sc">{</span>cv_scores<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-670"><a href="#cb8-670" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Mean CV F1 Score: </span><span class="sc">{</span>cv_scores<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss"> (+/- </span><span class="sc">{</span>cv_scores<span class="sc">.</span>std() <span class="op">*</span> <span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb8-671"><a href="#cb8-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-672"><a href="#cb8-672" aria-hidden="true" tabindex="-1"></a><span class="co"># Run predictive modeling with the fixed function</span></span>
<span id="cb8-673"><a href="#cb8-673" aria-hidden="true" tabindex="-1"></a>predict_employment(df, potential_features)</span>
<span id="cb8-674"><a href="#cb8-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-675"><a href="#cb8-675" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis: Employment outcomes by program</span></span>
<span id="cb8-676"><a href="#cb8-676" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> employment_by_program(df):</span>
<span id="cb8-677"><a href="#cb8-677" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Employment Outcomes by Program ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb8-678"><a href="#cb8-678" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-679"><a href="#cb8-679" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'PGMCIPAP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns <span class="kw">or</span> <span class="st">'LFSTATP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-680"><a href="#cb8-680" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Program or employment data not available."</span>)</span>
<span id="cb8-681"><a href="#cb8-681" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-682"><a href="#cb8-682" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-683"><a href="#cb8-683" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create cross-tabulation of program vs employment status</span></span>
<span id="cb8-684"><a href="#cb8-684" aria-hidden="true" tabindex="-1"></a>    program_emp <span class="op">=</span> pd.crosstab(df[<span class="st">'PGMCIPAP'</span>], df[<span class="st">'LFSTATP'</span>])</span>
<span id="cb8-685"><a href="#cb8-685" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-686"><a href="#cb8-686" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for programs with sufficient data</span></span>
<span id="cb8-687"><a href="#cb8-687" aria-hidden="true" tabindex="-1"></a>    program_emp <span class="op">=</span> program_emp[program_emp.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">&gt;</span> <span class="dv">50</span>]</span>
<span id="cb8-688"><a href="#cb8-688" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-689"><a href="#cb8-689" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(program_emp) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-690"><a href="#cb8-690" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Insufficient data for program employment analysis."</span>)</span>
<span id="cb8-691"><a href="#cb8-691" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-692"><a href="#cb8-692" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-693"><a href="#cb8-693" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate employment rate (employed / (employed + unemployed))</span></span>
<span id="cb8-694"><a href="#cb8-694" aria-hidden="true" tabindex="-1"></a>    program_emp[<span class="st">'Employment_Rate'</span>] <span class="op">=</span> program_emp[<span class="dv">1</span>] <span class="op">/</span> (program_emp[<span class="dv">1</span>] <span class="op">+</span> program_emp[<span class="dv">2</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb8-695"><a href="#cb8-695" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-696"><a href="#cb8-696" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by employment rate</span></span>
<span id="cb8-697"><a href="#cb8-697" aria-hidden="true" tabindex="-1"></a>    program_emp <span class="op">=</span> program_emp.sort_values(<span class="st">'Employment_Rate'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-698"><a href="#cb8-698" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-699"><a href="#cb8-699" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get all programs (not just top/bottom 10 since we have only 5)</span></span>
<span id="cb8-700"><a href="#cb8-700" aria-hidden="true" tabindex="-1"></a>    all_programs <span class="op">=</span> program_emp.copy()</span>
<span id="cb8-701"><a href="#cb8-701" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-702"><a href="#cb8-702" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create visualization</span></span>
<span id="cb8-703"><a href="#cb8-703" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">8</span>))</span>
<span id="cb8-704"><a href="#cb8-704" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-705"><a href="#cb8-705" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get program names - convert program codes to strings for lookup</span></span>
<span id="cb8-706"><a href="#cb8-706" aria-hidden="true" tabindex="-1"></a>    program_labels <span class="op">=</span> []</span>
<span id="cb8-707"><a href="#cb8-707" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pid <span class="kw">in</span> all_programs.index:</span>
<span id="cb8-708"><a href="#cb8-708" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert program code to string for lookup</span></span>
<span id="cb8-709"><a href="#cb8-709" aria-hidden="true" tabindex="-1"></a>        program_code_str <span class="op">=</span> <span class="bu">str</span>(<span class="bu">int</span>(pid)) <span class="cf">if</span> pid.is_integer() <span class="cf">else</span> <span class="bu">str</span>(pid)</span>
<span id="cb8-710"><a href="#cb8-710" aria-hidden="true" tabindex="-1"></a>        program_name <span class="op">=</span> get_response_value(<span class="st">'PGMCIPAP'</span>, program_code_str)</span>
<span id="cb8-711"><a href="#cb8-711" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program_name <span class="op">==</span> program_code_str:  <span class="co"># If no description found, use generic name</span></span>
<span id="cb8-712"><a href="#cb8-712" aria-hidden="true" tabindex="-1"></a>            program_name <span class="op">=</span> <span class="ss">f"Program </span><span class="sc">{</span>pid<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-713"><a href="#cb8-713" aria-hidden="true" tabindex="-1"></a>        program_labels.append(program_name)</span>
<span id="cb8-714"><a href="#cb8-714" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-715"><a href="#cb8-715" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create bar chart</span></span>
<span id="cb8-716"><a href="#cb8-716" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> plt.cm.viridis(np.linspace(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(all_programs)))</span>
<span id="cb8-717"><a href="#cb8-717" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(<span class="bu">range</span>(<span class="bu">len</span>(all_programs)), all_programs[<span class="st">'Employment_Rate'</span>], </span>
<span id="cb8-718"><a href="#cb8-718" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-719"><a href="#cb8-719" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-720"><a href="#cb8-720" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(all_programs)))</span>
<span id="cb8-721"><a href="#cb8-721" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(program_labels, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb8-722"><a href="#cb8-722" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Employment Rate (%)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-723"><a href="#cb8-723" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Employment Rate by Program'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-724"><a href="#cb8-724" aria-hidden="true" tabindex="-1"></a>    ax.invert_yaxis()  <span class="co"># Highest employment at the top</span></span>
<span id="cb8-725"><a href="#cb8-725" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-726"><a href="#cb8-726" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value labels</span></span>
<span id="cb8-727"><a href="#cb8-727" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, bar <span class="kw">in</span> <span class="bu">enumerate</span>(bars):</span>
<span id="cb8-728"><a href="#cb8-728" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb8-729"><a href="#cb8-729" aria-hidden="true" tabindex="-1"></a>        ax.text(width <span class="op">+</span> <span class="fl">0.5</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb8-730"><a href="#cb8-730" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>width<span class="sc">:.1f}</span><span class="ss">%'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb8-731"><a href="#cb8-731" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-732"><a href="#cb8-732" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb8-733"><a href="#cb8-733" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb8-734"><a href="#cb8-734" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-735"><a href="#cb8-735" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb8-736"><a href="#cb8-736" aria-hidden="true" tabindex="-1"></a>    ax.spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb8-737"><a href="#cb8-737" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-738"><a href="#cb8-738" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-739"><a href="#cb8-739" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-740"><a href="#cb8-740" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-741"><a href="#cb8-741" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the results with more information</span></span>
<span id="cb8-742"><a href="#cb8-742" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Programs by Employment Rate (with sufficient data):"</span>)</span>
<span id="cb8-743"><a href="#cb8-743" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pid, row <span class="kw">in</span> all_programs.iterrows():</span>
<span id="cb8-744"><a href="#cb8-744" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert program code to string for lookup</span></span>
<span id="cb8-745"><a href="#cb8-745" aria-hidden="true" tabindex="-1"></a>        program_code_str <span class="op">=</span> <span class="bu">str</span>(<span class="bu">int</span>(pid)) <span class="cf">if</span> pid.is_integer() <span class="cf">else</span> <span class="bu">str</span>(pid)</span>
<span id="cb8-746"><a href="#cb8-746" aria-hidden="true" tabindex="-1"></a>        program_name <span class="op">=</span> get_response_value(<span class="st">'PGMCIPAP'</span>, program_code_str)</span>
<span id="cb8-747"><a href="#cb8-747" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> program_name <span class="op">==</span> program_code_str:  <span class="co"># If no description found, use generic name</span></span>
<span id="cb8-748"><a href="#cb8-748" aria-hidden="true" tabindex="-1"></a>            program_name <span class="op">=</span> <span class="ss">f"Program </span><span class="sc">{</span>pid<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb8-749"><a href="#cb8-749" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-750"><a href="#cb8-750" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use .iloc to avoid the warning about position-based indexing</span></span>
<span id="cb8-751"><a href="#cb8-751" aria-hidden="true" tabindex="-1"></a>        employed <span class="op">=</span> row.iloc[<span class="dv">0</span>]  <span class="co"># First column (employed)</span></span>
<span id="cb8-752"><a href="#cb8-752" aria-hidden="true" tabindex="-1"></a>        unemployed <span class="op">=</span> row.iloc[<span class="dv">1</span>]  <span class="co"># Second column (unemployed)</span></span>
<span id="cb8-753"><a href="#cb8-753" aria-hidden="true" tabindex="-1"></a>        total <span class="op">=</span> employed <span class="op">+</span> unemployed</span>
<span id="cb8-754"><a href="#cb8-754" aria-hidden="true" tabindex="-1"></a>        rate <span class="op">=</span> row[<span class="st">'Employment_Rate'</span>]</span>
<span id="cb8-755"><a href="#cb8-755" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-756"><a href="#cb8-756" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>program_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>rate<span class="sc">:.1f}</span><span class="ss">% (</span><span class="sc">{</span>employed<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>total<span class="sc">}</span><span class="ss"> employed)"</span>)</span>
<span id="cb8-757"><a href="#cb8-757" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-758"><a href="#cb8-758" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Provide additional context</span></span>
<span id="cb8-759"><a href="#cb8-759" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Note: Only </span><span class="sc">{</span><span class="bu">len</span>(all_programs)<span class="sc">}</span><span class="ss"> programs had sufficient data (&gt;50 respondents)"</span>)</span>
<span id="cb8-760"><a href="#cb8-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-761"><a href="#cb8-761" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the program analysis</span></span>
<span id="cb8-762"><a href="#cb8-762" aria-hidden="true" tabindex="-1"></a>employment_by_program(df)</span>
<span id="cb8-763"><a href="#cb8-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-764"><a href="#cb8-764" aria-hidden="true" tabindex="-1"></a><span class="co"># Employment Income Heatmap by Region and Program with Mapped Labels</span></span>
<span id="cb8-765"><a href="#cb8-765" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> employment_income_heatmap(df):</span>
<span id="cb8-766"><a href="#cb8-766" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Employment Income Heatmap (JOBINCP) ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb8-767"><a href="#cb8-767" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-768"><a href="#cb8-768" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check necessary columns</span></span>
<span id="cb8-769"><a href="#cb8-769" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'JOBINCP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns <span class="kw">or</span> <span class="st">'REG_RESP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns <span class="kw">or</span> <span class="st">'PGMCIPAP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb8-770"><a href="#cb8-770" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Required columns for income heatmap not available."</span>)</span>
<span id="cb8-771"><a href="#cb8-771" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb8-772"><a href="#cb8-772" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-773"><a href="#cb8-773" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter for employed individuals only</span></span>
<span id="cb8-774"><a href="#cb8-774" aria-hidden="true" tabindex="-1"></a>    employed_df <span class="op">=</span> df[df[<span class="st">'LFSTATP'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb8-775"><a href="#cb8-775" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-776"><a href="#cb8-776" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map JOBINCP codes to midpoint values</span></span>
<span id="cb8-777"><a href="#cb8-777" aria-hidden="true" tabindex="-1"></a>    income_mapping <span class="op">=</span> {</span>
<span id="cb8-778"><a href="#cb8-778" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="dv">15000</span>,   <span class="co"># Under $30000 (midpoint)</span></span>
<span id="cb8-779"><a href="#cb8-779" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="dv">40000</span>,   <span class="co"># $30000-$49999</span></span>
<span id="cb8-780"><a href="#cb8-780" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>: <span class="dv">60000</span>,   <span class="co"># $50000-$69999</span></span>
<span id="cb8-781"><a href="#cb8-781" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="dv">80000</span>,   <span class="co"># $70000-$89999</span></span>
<span id="cb8-782"><a href="#cb8-782" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>: <span class="dv">95000</span>    <span class="co"># $90000+ (approximate midpoint)</span></span>
<span id="cb8-783"><a href="#cb8-783" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-784"><a href="#cb8-784" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-785"><a href="#cb8-785" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map region codes to region names</span></span>
<span id="cb8-786"><a href="#cb8-786" aria-hidden="true" tabindex="-1"></a>    region_mapping <span class="op">=</span> {</span>
<span id="cb8-787"><a href="#cb8-787" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="st">"Atlantic provinces"</span>,</span>
<span id="cb8-788"><a href="#cb8-788" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="st">"Quebec"</span>,</span>
<span id="cb8-789"><a href="#cb8-789" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>: <span class="st">"Ontario"</span>,</span>
<span id="cb8-790"><a href="#cb8-790" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="st">"Western provinces territories"</span></span>
<span id="cb8-791"><a href="#cb8-791" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-792"><a href="#cb8-792" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-793"><a href="#cb8-793" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Map program codes to program names</span></span>
<span id="cb8-794"><a href="#cb8-794" aria-hidden="true" tabindex="-1"></a>    program_mapping <span class="op">=</span> {</span>
<span id="cb8-795"><a href="#cb8-795" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="st">"Education"</span>,</span>
<span id="cb8-796"><a href="#cb8-796" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="st">"Social/behavioral sciences/law"</span>,</span>
<span id="cb8-797"><a href="#cb8-797" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>: <span class="st">"Business/management/public admin"</span>,</span>
<span id="cb8-798"><a href="#cb8-798" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span>: <span class="st">"Physical/life sciences/technologies"</span>,</span>
<span id="cb8-799"><a href="#cb8-799" aria-hidden="true" tabindex="-1"></a>        <span class="dv">7</span>: <span class="st">"Math/computer/info sciences"</span>,</span>
<span id="cb8-800"><a href="#cb8-800" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span>: <span class="st">"Architecture/engineering/trades"</span>,</span>
<span id="cb8-801"><a href="#cb8-801" aria-hidden="true" tabindex="-1"></a>        <span class="dv">9</span>: <span class="st">"Health fields"</span>,</span>
<span id="cb8-802"><a href="#cb8-802" aria-hidden="true" tabindex="-1"></a>        <span class="dv">10</span>: <span class="st">"Other"</span></span>
<span id="cb8-803"><a href="#cb8-803" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-804"><a href="#cb8-804" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-805"><a href="#cb8-805" aria-hidden="true" tabindex="-1"></a>    employed_df[<span class="st">'INCOME_MIDPOINT'</span>] <span class="op">=</span> employed_df[<span class="st">'JOBINCP'</span>].<span class="bu">map</span>(income_mapping)</span>
<span id="cb8-806"><a href="#cb8-806" aria-hidden="true" tabindex="-1"></a>    employed_df[<span class="st">'REGION_NAME'</span>] <span class="op">=</span> employed_df[<span class="st">'REG_RESP'</span>].<span class="bu">map</span>(region_mapping)</span>
<span id="cb8-807"><a href="#cb8-807" aria-hidden="true" tabindex="-1"></a>    employed_df[<span class="st">'PROGRAM_NAME'</span>] <span class="op">=</span> employed_df[<span class="st">'PGMCIPAP'</span>].<span class="bu">map</span>(program_mapping)</span>
<span id="cb8-808"><a href="#cb8-808" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-809"><a href="#cb8-809" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove rows with missing income, region, or program data</span></span>
<span id="cb8-810"><a href="#cb8-810" aria-hidden="true" tabindex="-1"></a>    employed_df <span class="op">=</span> employed_df.dropna(subset<span class="op">=</span>[<span class="st">'INCOME_MIDPOINT'</span>, <span class="st">'REGION_NAME'</span>, <span class="st">'PROGRAM_NAME'</span>])</span>
<span id="cb8-811"><a href="#cb8-811" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-812"><a href="#cb8-812" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by region and program, calculate mean income</span></span>
<span id="cb8-813"><a href="#cb8-813" aria-hidden="true" tabindex="-1"></a>    income_by_region_program <span class="op">=</span> employed_df.groupby([<span class="st">'REGION_NAME'</span>, <span class="st">'PROGRAM_NAME'</span>])[<span class="st">'INCOME_MIDPOINT'</span>].mean().unstack()</span>
<span id="cb8-814"><a href="#cb8-814" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-815"><a href="#cb8-815" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create heatmap</span></span>
<span id="cb8-816"><a href="#cb8-816" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>))</span>
<span id="cb8-817"><a href="#cb8-817" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.heatmap(</span>
<span id="cb8-818"><a href="#cb8-818" aria-hidden="true" tabindex="-1"></a>        income_by_region_program,</span>
<span id="cb8-819"><a href="#cb8-819" aria-hidden="true" tabindex="-1"></a>        annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-820"><a href="#cb8-820" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">=</span><span class="st">".0f"</span>,</span>
<span id="cb8-821"><a href="#cb8-821" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">"YlGnBu"</span>,</span>
<span id="cb8-822"><a href="#cb8-822" aria-hidden="true" tabindex="-1"></a>        cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Average Income ($)'</span>},</span>
<span id="cb8-823"><a href="#cb8-823" aria-hidden="true" tabindex="-1"></a>        linewidths<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb8-824"><a href="#cb8-824" aria-hidden="true" tabindex="-1"></a>        linecolor<span class="op">=</span><span class="st">'grey'</span></span>
<span id="cb8-825"><a href="#cb8-825" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-826"><a href="#cb8-826" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-827"><a href="#cb8-827" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set colorbar label size</span></span>
<span id="cb8-828"><a href="#cb8-828" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> ax.collections[<span class="dv">0</span>].colorbar</span>
<span id="cb8-829"><a href="#cb8-829" aria-hidden="true" tabindex="-1"></a>    cbar.ax.set_ylabel(<span class="st">'Average Income ($)'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-830"><a href="#cb8-830" aria-hidden="true" tabindex="-1"></a>    cbar.ax.tick_params(labelsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-831"><a href="#cb8-831" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-832"><a href="#cb8-832" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Average Employment Income by Region and Program</span><span class="ch">\n</span><span class="st">(JOBINCP Midpoint Values)'</span>, </span>
<span id="cb8-833"><a href="#cb8-833" aria-hidden="true" tabindex="-1"></a>              fontsize<span class="op">=</span><span class="dv">24</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-834"><a href="#cb8-834" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Program'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-835"><a href="#cb8-835" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Region'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-836"><a href="#cb8-836" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-837"><a href="#cb8-837" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set tick label size to 20</span></span>
<span id="cb8-838"><a href="#cb8-838" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(ax.get_xticklabels(), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-839"><a href="#cb8-839" aria-hidden="true" tabindex="-1"></a>    ax.set_yticklabels(ax.get_yticklabels(), fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb8-840"><a href="#cb8-840" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-841"><a href="#cb8-841" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rotate x-axis labels for better readability</span></span>
<span id="cb8-842"><a href="#cb8-842" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb8-843"><a href="#cb8-843" aria-hidden="true" tabindex="-1"></a>    plt.yticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)    </span>
<span id="cb8-844"><a href="#cb8-844" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust layout</span></span>
<span id="cb8-845"><a href="#cb8-845" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-846"><a href="#cb8-846" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-847"><a href="#cb8-847" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-848"><a href="#cb8-848" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print some summary statistics</span></span>
<span id="cb8-849"><a href="#cb8-849" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Summary Statistics:"</span>)</span>
<span id="cb8-850"><a href="#cb8-850" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Total employed individuals in analysis: </span><span class="sc">{</span><span class="bu">len</span>(employed_df)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-851"><a href="#cb8-851" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Average income across all employed: $</span><span class="sc">{</span>employed_df[<span class="st">'INCOME_MIDPOINT'</span>]<span class="sc">.</span>mean()<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb8-852"><a href="#cb8-852" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Highest paying region-program combination: $</span><span class="sc">{</span>income_by_region_program<span class="sc">.</span><span class="bu">max</span>()<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb8-853"><a href="#cb8-853" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Lowest paying region-program combination: $</span><span class="sc">{</span>income_by_region_program<span class="sc">.</span><span class="bu">min</span>()<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb8-854"><a href="#cb8-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-855"><a href="#cb8-855" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function</span></span>
<span id="cb8-856"><a href="#cb8-856" aria-hidden="true" tabindex="-1"></a>employment_income_heatmap(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Available columns in dataset:
['PUMFID', 'CERTLEVP', 'REG_INST', 'REG_RESP', 'PGMCIPAP', 'PGM_P034', 'PGM_P036', 'PGM_P100', 'PGM_P111', 'PGM_280A', 'PGM_280B', 'PGM_280C', 'PGM_280D', 'PGM_280E', 'PGM_280F', 'PGM_290', 'PGM_350', 'PGM_380', 'PGM_P401', 'PGM_410', 'PGM_415', 'PGM_430', 'COV_010', 'COV_070', 'COV_080', 'EDU_010', 'EDU_P020', 'HLOSINTP', 'STL_010', 'STL_020', 'STULOANS', 'STL_030', 'OWESLGD', 'OWEGVIN', 'STL_080', 'STL_100A', 'STL_100B', 'STL_100C', 'STL_100D', 'STL_130', 'STL_150', 'STL_160B', 'STL_160C', 'STL_160D', 'STL_160E', 'STL_160F', 'STL_160G', 'STL_160H', 'STL_160I', 'STL_160J', 'STL_160L', 'STLP160N', 'SRCFUND', 'STL_170A', 'STL_170B', 'STL_170C', 'STL_170D', 'STL_170E', 'STL_170F', 'STL_170G', 'STL_170H', 'STL_170I', 'STL_170J', 'STL_170L', 'STLP170N', 'RESPP', 'STL_190', 'DBTOTGRD', 'DBTALGRD', 'DBTOTINT', 'DBTALINT', 'SCHOLARP', 'LMA_010', 'LFSTATP', 'LMA2_07', 'LMA3_P01', 'LFCINDP', 'LFCOCCP', 'LFWFTPTP', 'LMA6_05', 'LMA6_08', 'JOBQLEVP', 'JOBQLGRD', 'JOBQLINT', 'LMA6_11', 'LMA6_12', 'LMA6_13A', 'LMA6_13B', 'LMA6_13C', 'JOBINCP', 'LMA6_15', 'AFT_P010', 'AFT_P020', 'AFT_P040', 'AFT_050', 'AFT_070', 'AFT_080', 'AFT_090', 'BEF_P140', 'BEF_160', 'PREVLEVP', 'HLOSGRDP', 'PAR1GRD', 'PAR1INT', 'PAR2GRD', 'PAR2INT', 'GRADAGEP', 'GENDER2', 'MS_P01', 'MS_P02', 'CTZSHIPP', 'VISBMINP', 'PERSINCP', 'DDIS_FL']</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-2.png" width="1198" height="1889" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Employment Status Analysis ===

Reference week - Labour force status Distribution:
1.0: 14129
3.0: 1147
2.0: 829
nan: 33</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-4.png" width="1596" height="589" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Correlation Analysis ===
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-6.png" width="1162" height="962" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Using the following features for modeling: ['GENDER2', 'CERTLEVP', 'PERSINCP', 'GRADAGEP', 'VISBMINP', 'CTZSHIPP', 'MS_P01', 'REG_INST', 'EDU_010', 'PGMCIPAP', 'STULOANS', 'JOBINCP', 'LFCINDP', 'LFCOCCP', 'LMA6_11', 'COV_010', 'LMA_010']

=== Predictive Modeling: Employment Status Prediction ===

Removed job-related features: ['JOBINCP', 'LFCINDP', 'LFCOCCP', 'LMA6_11']
Using features: ['Gender after distribution of non-binary persons', '2020 Program - Level of study - Grouping', 'Total personal income in 2022', '2020 Program - Age at time of graduation - Grouping', 'Self-identified as a member of a visible minority group', 'Time of interview 2023 - Status in Canada', 'Marital status', '2020 Program - Region of postsecondary educational institution', 'After 2020 program - Other postsecondary programs taken', '2020 Program - Aggregated CIP 2021', 'Government-student loan program - Received', 'COVID-19 - Completion of program delayed', 'Reference week - Attended school, college, CEGEP or university']
Class distribution after processing: {1.0: np.int64(5516), 2.0: np.int64(336)}
Class weights: {np.float64(1.0): np.float64(0.5304325304325305), np.float64(2.0): np.float64(8.714893617021277)}
After SMOTE - Class distribution: [   0 3861 3861]
1. SelectKBest Feature Selection:
Selected features: ['2020 Program - Level of study - Grouping', 'Total personal income in 2022', '2020 Program - Age at time of graduation - Grouping', 'Marital status', 'COVID-19 - Completion of program delayed']

2. Recursive Feature Elimination (RFE):
Selected features: ['Total personal income in 2022', 'Time of interview 2023 - Status in Canada', 'Marital status', 'Government-student loan program - Received', 'Reference week - Attended school, college, CEGEP or university']

3. Random Forest Feature Importance:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Fuxim\miniconda3\envs\quarto-env\lib\site-packages\sklearn\base.py:474: FutureWarning:

`BaseEstimator._validate_data` is deprecated in 1.6 and will be removed in 1.7. Use `sklearn.utils.validation.validate_data` instead. This function becomes public and is part of the scikit-learn developer API.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-9.png" width="1191" height="989" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 5 features: ['Total personal income in 2022', 'Marital status', 'Gender after distribution of non-binary persons', '2020 Program - Level of study - Grouping', '2020 Program - Aggregated CIP 2021']

4. Model Performance Comparison:
All features accuracy: 0.9305239179954442
Top 5 features accuracy: 0.8849658314350797
SelectKBest features accuracy: 0.8883826879271071
RFE features accuracy: 0.8604783599088838</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-11.png" width="990" height="588" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification Report - All Features:
              precision    recall  f1-score   support

         1.0       0.95      0.98      0.96      1655
         2.0       0.20      0.07      0.10       101

    accuracy                           0.93      1756
   macro avg       0.57      0.53      0.53      1756
weighted avg       0.90      0.93      0.91      1756

Classification Report - Top 5 Features:
              precision    recall  f1-score   support

         1.0       0.95      0.93      0.94      1655
         2.0       0.15      0.22      0.18       101

    accuracy                           0.88      1756
   macro avg       0.55      0.57      0.56      1756
weighted avg       0.90      0.88      0.89      1756
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-13.png" width="745" height="589" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Precision-Recall AUC: 0.124</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-15.png" width="845" height="704" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal Threshold: 0.319
Optimal Precision: 0.143
Optimal Recall: 0.307

Classification Report with Optimal Threshold:
              precision    recall  f1-score   support

         1.0       0.95      0.89      0.92      1655
         2.0       0.14      0.31      0.19       101

    accuracy                           0.85      1756
   macro avg       0.55      0.60      0.56      1756
weighted avg       0.91      0.85      0.88      1756


6. XGBoost Model with Class Weighting:
Class ratio (majority:minority): 16.43:1
XGBoost Classification Report:
              precision    recall  f1-score   support

         1.0       0.96      0.66      0.78      1655
         2.0       0.10      0.60      0.17       101

    accuracy                           0.66      1756
   macro avg       0.53      0.63      0.48      1756
weighted avg       0.91      0.66      0.75      1756
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-17.png" width="1189" height="989" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
7. Cross-Validation Results:
Cross-Validation F1 Scores: [0.91844517 0.90291254 0.91644906 0.91774194 0.92421361]
Mean CV F1 Score: 0.916 (+/- 0.014)

=== Employment Outcomes by Program ===
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-19.png" width="1397" height="788" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Programs by Employment Rate (with sufficient data):
Education: 97.0% (1167.0/1203.0 employed)
Health and related fields: 96.9% (2216.0/2286.0 employed)
Business, management and public administration: 95.3% (3465.0/3637.0 employed)
Social and behavioural sciences and law: 94.1% (1967.0/2091.0 employed)
Architecture, engineering, and related trades: 93.4% (1955.0/2094.0 employed)
Mathematics, computer and information sciences: 93.3% (829.0/889.0 employed)
Physical and life sciences and technologies: 92.3% (703.0/762.0 employed)
Other: 91.8% (807.0/879.0 employed)
Visual/performing arts / comms technologies / Humanities: 91.1% (977.0/1073.0 employed)

Note: Only 9 programs had sufficient data (&gt;50 respondents)

=== Employment Income Heatmap (JOBINCP) ===
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-7-output-21.png" width="1556" height="1190" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary Statistics:
Total employed individuals in analysis: 11703
Average income across all employed: $63039
Highest paying region-program combination: $76425
Lowest paying region-program combination: $49685</code></pre>
</div>
</div>
</section>
<section id="employment-income-linear-regression" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="employment-income-linear-regression"><span class="header-section-number">6.2</span> Employment Income (Linear Regression)</h2>
<div id="a4acd869" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder, StandardScaler</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> SelectKBest, f_regression, RFE, VarianceThreshold</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression, Ridge</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, mean_absolute_error</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out the specific warnings</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">UserWarning</span>, module<span class="op">=</span><span class="st">"sklearn.feature_selection._univariate_selection"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">RuntimeWarning</span>, module<span class="op">=</span><span class="st">"sklearn.feature_selection._univariate_selection"</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set professional style with a modern color palette</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'default'</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>sns.set_palette(<span class="st">"husl"</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">8</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titlesize'</span>] <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.labelsize'</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'xtick.labelsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'ytick.labelsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'legend.fontsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.titlesize'</span>] <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the YAML files with feature descriptions and response codes</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_feature_descriptions(file_path<span class="op">=</span><span class="st">'ngs2020_questions.yaml'</span>):</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>            questions <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> questions</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: File '</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">' not found."</span>)</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> yaml.YAMLError <span class="im">as</span> e:</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error parsing YAML file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_response_codes(file_path<span class="op">=</span><span class="st">'ngs2020_responses.yaml'</span>):</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>            responses <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> responses</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: File '</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">' not found."</span>)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> yaml.YAMLError <span class="im">as</span> e:</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error parsing YAML file: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {}</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Load feature descriptions and response codes</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>feature_descriptions <span class="op">=</span> load_feature_descriptions()</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>response_codes <span class="op">=</span> load_response_codes()</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get human-readable feature names</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_feature_name(feature_code):</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> feature_descriptions.get(feature_code, feature_code)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get human-readable response values</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_response_value(feature_code, value):</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_code <span class="kw">in</span> response_codes <span class="kw">and</span> <span class="bu">str</span>(value) <span class="kw">in</span> response_codes[feature_code]:</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> response_codes[feature_code][<span class="bu">str</span>(value)]</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to map a series to human-readable values</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_series_to_readable(series, feature_code):</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_code <span class="kw">in</span> response_codes:</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>        mapping <span class="op">=</span> response_codes[feature_code]</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> series.<span class="bu">map</span>(<span class="kw">lambda</span> x: mapping.get(<span class="bu">str</span>(x), x))</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get readable labels for plotting</span></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_readable_labels(feature_code, values):</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature_code <span class="kw">in</span> response_codes:</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [response_codes[feature_code].get(<span class="bu">str</span>(val), <span class="bu">str</span>(val)) <span class="cf">for</span> val <span class="kw">in</span> values]</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [<span class="bu">str</span>(val) <span class="cf">for</span> val <span class="kw">in</span> values]</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to map income codes to midpoint values</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_income_to_midpoint(income_code):</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>    income_mapping <span class="op">=</span> {</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="dv">15000</span>,    <span class="co"># Less than $30,000 -&gt; midpoint $15,000</span></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="dv">40000</span>,    <span class="co"># $30,000 to $49,999 -&gt; midpoint $40,000</span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>: <span class="dv">60000</span>,    <span class="co"># $50,000 to $69,999 -&gt; midpoint $60,000</span></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="dv">80000</span>,    <span class="co"># $70,000 to $89,999 -&gt; midpoint $80,000</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>: <span class="dv">100000</span>    <span class="co"># $90,000 or more -&gt; approximate midpoint $100,000</span></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> income_mapping.get(income_code, np.nan)</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the actual data</span></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'ngs2020.csv'</span>)</span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Print available columns to help debug</span></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Available columns in dataset:"</span>)</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns.tolist())</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Define missing value codes based on the data documentation</span></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>missing_codes <span class="op">=</span> [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">96</span>, <span class="dv">97</span>, <span class="dv">98</span>, <span class="dv">99</span>]</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to visualize missing data</span></span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_missing_data(df):</span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>    missing <span class="op">=</span> df.isin(missing_codes).mean() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>    missing <span class="op">=</span> missing[missing <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>    missing.sort_values(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use human-readable feature names</span></span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>    missing.index <span class="op">=</span> [get_feature_name(col) <span class="cf">for</span> col <span class="kw">in</span> missing.index]</span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create visualization</span></span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">19</span>))</span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> plt.cm.viridis(np.linspace(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(missing)))</span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.barh(missing.index, missing.values, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value annotations on bars</span></span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>        ax.text(width <span class="op">+</span> <span class="fl">0.5</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>width<span class="sc">:.1f}</span><span class="ss">%'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Percentage (%)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Column Name'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Percentage of Missing/Special Values by Column'</span>, </span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a>                 fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a>    ax.spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a subtle background</span></span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a>    ax.set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a>plot_missing_data(df)</span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Data cleaning - replace missing codes with NaN</span></span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Special handling for VISBMINP and GRADAGEP to preserve category 9 as a valid response</span></span>
<span id="cb21-152"><a href="#cb21-152" aria-hidden="true" tabindex="-1"></a>preserve_codes <span class="op">=</span> {<span class="st">'VISBMINP'</span>: [<span class="dv">9</span>], <span class="st">'GRADAGEP'</span>: [<span class="dv">9</span>]}  <span class="co"># Codes to keep as-is for specific variables</span></span>
<span id="cb21-153"><a href="#cb21-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a><span class="co"># for col in df.columns:</span></span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a><span class="co">#     if df[col].dtype in ['int64', 'float64']:</span></span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a><span class="co">#         if col in preserve_codes:</span></span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a><span class="co">#             # For variables with preserved codes, only replace codes not in the preserve list</span></span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a><span class="co">#             codes_to_replace = [c for c in missing_codes if c not in preserve_codes[col]]</span></span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a><span class="co">#             df[col] = df[col].replace(codes_to_replace, np.nan)</span></span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a><span class="co">#         else:</span></span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a><span class="co">#             # For all other variables, replace all missing codes</span></span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a><span class="co">#             df[col] = df[col].replace(missing_codes, np.nan)</span></span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Data cleaning - replace missing codes with NaN</span></span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Special handling for VISBMINP and GRADAGEP to preserve category 9 as a valid response</span></span>
<span id="cb21-166"><a href="#cb21-166" aria-hidden="true" tabindex="-1"></a>preserve_codes <span class="op">=</span> {<span class="st">'VISBMINP'</span>: [<span class="dv">9</span>], <span class="st">'GRADAGEP'</span>: [<span class="dv">9</span>]}  <span class="co"># Codes to keep as-is for specific variables</span></span>
<span id="cb21-167"><a href="#cb21-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't apply missing code replacement to the program column</span></span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a>columns_to_clean <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'PGMCIPAP'</span>]</span>
<span id="cb21-170"><a href="#cb21-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-171"><a href="#cb21-171" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columns_to_clean:</span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df[col].dtype <span class="kw">in</span> [<span class="st">'int64'</span>, <span class="st">'float64'</span>]:</span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> preserve_codes:</span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For variables with preserved codes, only replace codes not in the preserve list</span></span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a>            codes_to_replace <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> missing_codes <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> preserve_codes[col]]</span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a>            df[col] <span class="op">=</span> df[col].replace(codes_to_replace, np.nan)</span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For all other variables, replace all missing codes</span></span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a>            df[col] <span class="op">=</span> df[col].replace(missing_codes, np.nan)</span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a><span class="co"># For the program column, only replace the actual missing codes (96, 97, 98, 99)</span></span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'PGMCIPAP'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'PGMCIPAP'</span>] <span class="op">=</span> df[<span class="st">'PGMCIPAP'</span>].replace([<span class="dv">96</span>, <span class="dv">97</span>, <span class="dv">98</span>, <span class="dv">99</span>], np.nan)</span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Map income codes to midpoint values</span></span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'PERSINCP_midpoint'</span>] <span class="op">=</span> df[<span class="st">'PERSINCP'</span>].<span class="bu">apply</span>(map_income_to_midpoint)</span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Income Distribution Analysis</span></span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> income_analysis(df):</span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Income Distribution Analysis ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-191"><a href="#cb21-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-192"><a href="#cb21-192" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'PERSINCP_midpoint'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Personal income data not available."</span>)</span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to only employed individuals for income analysis</span></span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a>    income_df <span class="op">=</span> df[df[<span class="st">'LFSTATP'</span>] <span class="op">==</span> <span class="dv">1</span>].copy() <span class="cf">if</span> <span class="st">'LFSTATP'</span> <span class="kw">in</span> df.columns <span class="cf">else</span> df.copy()</span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-199"><a href="#cb21-199" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a figure for income analysis plots</span></span>
<span id="cb21-200"><a href="#cb21-200" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color palette</span></span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> sns.color_palette(<span class="st">"husl"</span>, <span class="dv">8</span>)</span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Income distribution</span></span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a>    income_data <span class="op">=</span> income_df[<span class="st">'PERSINCP_midpoint'</span>].dropna()</span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>get_feature_name(<span class="st">'PERSINCP'</span>)<span class="sc">}</span><span class="ss"> Statistics:"</span>)</span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Mean: $</span><span class="sc">{</span>income_data<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Median: $</span><span class="sc">{</span>income_data<span class="sc">.</span>median()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Standard Deviation: $</span><span class="sc">{</span>income_data<span class="sc">.</span>std()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Min: $</span><span class="sc">{</span>income_data<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Max: $</span><span class="sc">{</span>income_data<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create histogram for income distribution</span></span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].hist(income_data, bins<span class="op">=</span><span class="dv">30</span>, color<span class="op">=</span>colors[<span class="dv">0</span>], alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Income ($)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Frequency'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(<span class="ss">f'</span><span class="sc">{</span>get_feature_name(<span class="st">"PERSINCP"</span>)<span class="sc">}</span><span class="ss"> Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Income by education level</span></span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'CERTLEVP'</span> <span class="kw">in</span> income_df.columns:</span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Group by education level and calculate mean income</span></span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a>        income_by_edu <span class="op">=</span> income_df.groupby(<span class="st">'CERTLEVP'</span>)[<span class="st">'PERSINCP_midpoint'</span>].mean().dropna()</span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get readable labels</span></span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a>        edu_labels <span class="op">=</span> get_readable_labels(<span class="st">'CERTLEVP'</span>, income_by_edu.index)</span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create bar chart</span></span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> axes[<span class="dv">1</span>].bar(edu_labels, income_by_edu.values, color<span class="op">=</span>colors[:<span class="bu">len</span>(income_by_edu)], </span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a>                          alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_title(<span class="st">'Average Income by Education Level'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Average Income ($)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_xticklabels([<span class="st">"College"</span>,<span class="st">"Bachelor's"</span>,<span class="st">"Master's / Doctorate"</span>])</span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add value labels on top of bars</span></span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> bar.get_height()</span>
<span id="cb21-248"><a href="#cb21-248" aria-hidden="true" tabindex="-1"></a>            axes[<span class="dv">1</span>].text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height <span class="op">+</span> <span class="dv">500</span>,</span>
<span id="cb21-249"><a href="#cb21-249" aria-hidden="true" tabindex="-1"></a>                        <span class="ss">f'$</span><span class="sc">{</span>height<span class="sc">:.0f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add grid</span></span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove spines</span></span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a>        axes[<span class="dv">1</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Education level data (CERTLEVP) not available for income analysis."</span>)</span>
<span id="cb21-259"><a href="#cb21-259" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-260"><a href="#cb21-260" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background color to the figure</span></span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a>    fig.patch.set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a>income_analysis(df)</span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Analysis with Income Focus</span></span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> correlation_analysis(df):</span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Correlation Analysis ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select columns that might have meaningful correlations with income</span></span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a>    corr_cols <span class="op">=</span> [</span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a>        <span class="st">'GRADAGEP'</span>, </span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a>        <span class="st">'PERSINCP_midpoint'</span>, </span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a>        <span class="st">'JOBINCP'</span>,  </span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a>        <span class="st">'STULOANS'</span>, </span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CERTLEVP'</span>,</span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb21-280"><a href="#cb21-280" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-281"><a href="#cb21-281" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add additional columns if they exist</span></span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a>    optional_cols <span class="op">=</span> [<span class="st">'LFCINDP'</span>, <span class="st">'LFCOCCP'</span>, <span class="st">'COV_010'</span>, <span class="st">'GENDER2'</span>, <span class="st">'VISBMINP'</span>, <span class="st">'CTZSHIPP'</span>]</span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> optional_cols:</span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a>            corr_cols.append(col)</span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to only include columns that exist in the dataset</span></span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a>    corr_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> corr_cols <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb21-289"><a href="#cb21-289" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-290"><a href="#cb21-290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(corr_cols) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Not enough columns for correlation analysis."</span>)</span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a>    corr_df <span class="op">=</span> df[corr_cols].copy()</span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out missing codes</span></span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> corr_cols:</span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a>        corr_df <span class="op">=</span> corr_df[<span class="op">~</span>corr_df[col].isin(missing_codes)]</span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-300"><a href="#cb21-300" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute correlation matrix</span></span>
<span id="cb21-301"><a href="#cb21-301" aria-hidden="true" tabindex="-1"></a>    corr_matrix <span class="op">=</span> corr_df.corr()</span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get human-readable labels</span></span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a>    human_labels <span class="op">=</span> [get_feature_name(col) <span class="cf">for</span> col <span class="kw">in</span> corr_cols]</span>
<span id="cb21-305"><a href="#cb21-305" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-306"><a href="#cb21-306" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot heatmap</span></span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a mask for the upper triangle</span></span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> np.triu(np.ones_like(corr_matrix, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create heatmap with mask</span></span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a>    heatmap <span class="op">=</span> sns.heatmap(</span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a>        corr_matrix,</span>
<span id="cb21-315"><a href="#cb21-315" aria-hidden="true" tabindex="-1"></a>        annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-316"><a href="#cb21-316" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">'RdBu_r'</span>,</span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a>        center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">=</span><span class="st">".2f"</span>,</span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a>        square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-320"><a href="#cb21-320" aria-hidden="true" tabindex="-1"></a>        mask<span class="op">=</span>mask,</span>
<span id="cb21-321"><a href="#cb21-321" aria-hidden="true" tabindex="-1"></a>        cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>},</span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a>        annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">11</span>, <span class="st">"weight"</span>: <span class="st">"bold"</span>},</span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a>        linewidths<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a>        linecolor<span class="op">=</span><span class="st">'white'</span></span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set title</span></span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Correlation Matrix of Key Variables (Income Focus)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set x-axis labels with rotation</span></span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a>    heatmap.set_xticklabels(human_labels, rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set y-axis labels with proper rotation and alignment</span></span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a>    heatmap.set_yticklabels(human_labels, rotation<span class="op">=</span><span class="dv">0</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background</span></span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-339"><a href="#cb21-339" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-340"><a href="#cb21-340" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a>correlation_analysis(df)</span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a><span class="co"># Define potential features for income prediction modeling</span></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a>potential_features <span class="op">=</span> [</span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a>    <span class="st">'GENDER2'</span>, <span class="st">'CERTLEVP'</span>, <span class="st">'GRADAGEP'</span>, <span class="st">'VISBMINP'</span>, </span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CTZSHIPP'</span>, <span class="st">'MS_P01'</span>, <span class="st">'REG_INST'</span>, <span class="st">'EDU_010'</span>,</span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PGMCIPAP'</span>, <span class="st">'STULOANS'</span>, <span class="st">'JOBINCP'</span></span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Add optional features if they exist in the dataset</span></span>
<span id="cb21-352"><a href="#cb21-352" aria-hidden="true" tabindex="-1"></a>optional_features <span class="op">=</span> [<span class="st">'LFCINDP'</span>, <span class="st">'LFCOCCP'</span>, <span class="st">'LMA6_11'</span>, <span class="st">'COV_010'</span>, <span class="st">'LMA_010'</span>, <span class="st">'LMA_020'</span>, <span class="st">'LMA_030'</span>]</span>
<span id="cb21-353"><a href="#cb21-353" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature <span class="kw">in</span> optional_features:</span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature <span class="kw">in</span> df.columns:</span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a>        potential_features.append(feature)</span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to only include columns that exist in the dataset</span></span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a>potential_features <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> potential_features <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb21-359"><a href="#cb21-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-360"><a href="#cb21-360" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Using the following features for modeling: </span><span class="sc">{</span>potential_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictive Modeling with Feature Selection for Income</span></span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_income(df, features):</span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Predictive Modeling: Income Prediction ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-365"><a href="#cb21-365" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-366"><a href="#cb21-366" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'PERSINCP_midpoint'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Income data (PERSINCP_midpoint) not available for modeling."</span>)</span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to only employed individuals for income prediction</span></span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'LFSTATP'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb21-372"><a href="#cb21-372" aria-hidden="true" tabindex="-1"></a>        employed_df <span class="op">=</span> df[df[<span class="st">'LFSTATP'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb21-373"><a href="#cb21-373" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a>        employed_df <span class="op">=</span> df.copy()</span>
<span id="cb21-375"><a href="#cb21-375" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-376"><a href="#cb21-376" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove job-related features that might have high missing rates</span></span>
<span id="cb21-377"><a href="#cb21-377" aria-hidden="true" tabindex="-1"></a>    job_features_to_remove <span class="op">=</span> [<span class="st">'JOBINCP'</span>, <span class="st">'LFCINDP'</span>, <span class="st">'LFCOCCP'</span>, <span class="st">'LMA6_11'</span>]</span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> features <span class="cf">if</span> f <span class="kw">not</span> <span class="kw">in</span> job_features_to_remove]</span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Removed job-related features: </span><span class="sc">{</span>job_features_to_remove<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Using features: </span><span class="sc">{</span>[get_feature_name(f) <span class="cf">for</span> f <span class="kw">in</span> features]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data with potential features</span></span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a>    model_df <span class="op">=</span> employed_df[features <span class="op">+</span> [<span class="st">'PERSINCP_midpoint'</span>]].copy()</span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace missing codes with NaN</span></span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> model_df.columns:</span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_df[col].dtype <span class="kw">in</span> [<span class="st">'int64'</span>, <span class="st">'float64'</span>]:</span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> col <span class="kw">in</span> preserve_codes:</span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a>                codes_to_replace <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> missing_codes <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> preserve_codes[col]]</span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a>                model_df[col] <span class="op">=</span> model_df[col].replace(codes_to_replace, np.nan)</span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a>                model_df[col] <span class="op">=</span> model_df[col].replace(missing_codes, np.nan)</span>
<span id="cb21-393"><a href="#cb21-393" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-394"><a href="#cb21-394" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop rows with missing values</span></span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a>    model_df <span class="op">=</span> model_df.dropna()</span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-397"><a href="#cb21-397" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check data size</span></span>
<span id="cb21-398"><a href="#cb21-398" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(model_df) <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Not enough data for modeling. Only </span><span class="sc">{</span><span class="bu">len</span>(model_df)<span class="sc">}</span><span class="ss"> samples available."</span>)</span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert categorical variables to numerical</span></span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a>    le <span class="op">=</span> LabelEncoder()</span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> features:</span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> model_df[col].dtype <span class="op">==</span> <span class="st">'object'</span>:</span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a>            model_df[col] <span class="op">=</span> le.fit_transform(model_df[col])</span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split data</span></span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> model_df.drop(<span class="st">'PERSINCP_midpoint'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> model_df[<span class="st">'PERSINCP_midpoint'</span>]</span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a>        X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove constant features</span></span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a>    selector <span class="op">=</span> VarianceThreshold()</span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a>    X_train_clean <span class="op">=</span> selector.fit_transform(X_train)</span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a>    X_test_clean <span class="op">=</span> selector.transform(X_test)</span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the feature names after removing constant features</span></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a>    selected_features <span class="op">=</span> X.columns[selector.get_support()]</span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> pd.DataFrame(X_train_clean, columns<span class="op">=</span>selected_features)</span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> pd.DataFrame(X_test_clean, columns<span class="op">=</span>selected_features)</span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(selected_features) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No features remaining after variance threshold. Cannot proceed with modeling."</span>)</span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature Selection Methods</span></span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method 1: SelectKBest with F-regression</span></span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"1. SelectKBest Feature Selection:"</span>)</span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(selected_features))</span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a>    selector_kbest <span class="op">=</span> SelectKBest(score_func<span class="op">=</span>f_regression, k<span class="op">=</span>k)</span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a>    X_kbest <span class="op">=</span> selector_kbest.fit_transform(X_train, y_train)</span>
<span id="cb21-435"><a href="#cb21-435" aria-hidden="true" tabindex="-1"></a>    selected_features_kbest <span class="op">=</span> selected_features[selector_kbest.get_support()]</span>
<span id="cb21-436"><a href="#cb21-436" aria-hidden="true" tabindex="-1"></a>    selected_features_kbest_desc <span class="op">=</span> [get_feature_name(feat) <span class="cf">for</span> feat <span class="kw">in</span> selected_features_kbest]</span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Selected features: </span><span class="sc">{</span>selected_features_kbest_desc<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method 2: Recursive Feature Elimination (RFE)</span></span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">2. Recursive Feature Elimination (RFE):"</span>)</span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a>    estimator <span class="op">=</span> LinearRegression()</span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a>    n_features <span class="op">=</span> <span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(selected_features))</span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a>    selector_rfe <span class="op">=</span> RFE(estimator, n_features_to_select<span class="op">=</span>n_features, step<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a>    X_rfe <span class="op">=</span> selector_rfe.fit_transform(X_train, y_train)</span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a>    selected_features_rfe <span class="op">=</span> selected_features[selector_rfe.get_support()]</span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a>    selected_features_rfe_desc <span class="op">=</span> [get_feature_name(feat) <span class="cf">for</span> feat <span class="kw">in</span> selected_features_rfe]</span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Selected features: </span><span class="sc">{</span>selected_features_rfe_desc<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Method 3: Feature Importance from Random Forest</span></span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. Random Forest Feature Importance:"</span>)</span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a>    rf.fit(X_train, y_train)</span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot feature importance</span></span>
<span id="cb21-455"><a href="#cb21-455" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> pd.Series(rf.feature_importances_, index<span class="op">=</span>selected_features)</span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a>    importance.index <span class="op">=</span> [get_feature_name(feat) <span class="cf">for</span> feat <span class="kw">in</span> importance.index]</span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a>    importance <span class="op">=</span> importance.sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a horizontal bar chart for feature importance</span></span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> plt.cm.viridis(np.linspace(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(importance)))</span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> plt.barh(importance.index, importance.values, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)  <span class="co"># Added missing closing parenthesis</span></span>
<span id="cb21-463"><a href="#cb21-463" aria-hidden="true" tabindex="-1"></a>    plt.tick_params(axis<span class="op">=</span><span class="st">'y'</span>, labelsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb21-464"><a href="#cb21-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-465"><a href="#cb21-465" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-466"><a href="#cb21-466" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value annotations on bars</span></span>
<span id="cb21-467"><a href="#cb21-467" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb21-468"><a href="#cb21-468" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb21-469"><a href="#cb21-469" aria-hidden="true" tabindex="-1"></a>        plt.text(width <span class="op">+</span> <span class="fl">0.001</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb21-470"><a href="#cb21-470" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>width<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb21-471"><a href="#cb21-471" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-472"><a href="#cb21-472" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb21-473"><a href="#cb21-473" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Importance Score'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-474"><a href="#cb21-474" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Features'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-475"><a href="#cb21-475" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Feature Importance for Income Prediction'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-476"><a href="#cb21-476" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-477"><a href="#cb21-477" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb21-478"><a href="#cb21-478" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-479"><a href="#cb21-479" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-480"><a href="#cb21-480" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb21-481"><a href="#cb21-481" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb21-482"><a href="#cb21-482" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-483"><a href="#cb21-483" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background</span></span>
<span id="cb21-484"><a href="#cb21-484" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb21-485"><a href="#cb21-485" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-486"><a href="#cb21-486" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-487"><a href="#cb21-487" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-488"><a href="#cb21-488" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-489"><a href="#cb21-489" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select top 5 features based on importance</span></span>
<span id="cb21-490"><a href="#cb21-490" aria-hidden="true" tabindex="-1"></a>    top_features <span class="op">=</span> importance.nlargest(<span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(importance))).index.tolist()</span>
<span id="cb21-491"><a href="#cb21-491" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Top 5 features: </span><span class="sc">{</span>top_features<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-492"><a href="#cb21-492" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-493"><a href="#cb21-493" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compare performance with and without feature selection</span></span>
<span id="cb21-494"><a href="#cb21-494" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">4. Model Performance Comparison:"</span>)</span>
<span id="cb21-495"><a href="#cb21-495" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-496"><a href="#cb21-496" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Baseline model (all features)</span></span>
<span id="cb21-497"><a href="#cb21-497" aria-hidden="true" tabindex="-1"></a>    model_all <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb21-498"><a href="#cb21-498" aria-hidden="true" tabindex="-1"></a>    model_all.fit(X_train, y_train)</span>
<span id="cb21-499"><a href="#cb21-499" aria-hidden="true" tabindex="-1"></a>    y_pred_all <span class="op">=</span> model_all.predict(X_test)</span>
<span id="cb21-500"><a href="#cb21-500" aria-hidden="true" tabindex="-1"></a>    rmse_all <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred_all))</span>
<span id="cb21-501"><a href="#cb21-501" aria-hidden="true" tabindex="-1"></a>    r2_all <span class="op">=</span> r2_score(y_test, y_pred_all)</span>
<span id="cb21-502"><a href="#cb21-502" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"All features RMSE: $</span><span class="sc">{</span>rmse_all<span class="sc">:.2f}</span><span class="ss">, RÂ²: </span><span class="sc">{</span>r2_all<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb21-503"><a href="#cb21-503" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-504"><a href="#cb21-504" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model with top 5 features from RF importance</span></span>
<span id="cb21-505"><a href="#cb21-505" aria-hidden="true" tabindex="-1"></a>    top_feature_codes <span class="op">=</span> [feat <span class="cf">for</span> feat <span class="kw">in</span> selected_features <span class="cf">if</span> get_feature_name(feat) <span class="kw">in</span> top_features]</span>
<span id="cb21-506"><a href="#cb21-506" aria-hidden="true" tabindex="-1"></a>    X_train_top <span class="op">=</span> X_train[top_feature_codes]</span>
<span id="cb21-507"><a href="#cb21-507" aria-hidden="true" tabindex="-1"></a>    X_test_top <span class="op">=</span> X_test[top_feature_codes]</span>
<span id="cb21-508"><a href="#cb21-508" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-509"><a href="#cb21-509" aria-hidden="true" tabindex="-1"></a>    model_top <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb21-510"><a href="#cb21-510" aria-hidden="true" tabindex="-1"></a>    model_top.fit(X_train_top, y_train)</span>
<span id="cb21-511"><a href="#cb21-511" aria-hidden="true" tabindex="-1"></a>    y_pred_top <span class="op">=</span> model_top.predict(X_test_top)</span>
<span id="cb21-512"><a href="#cb21-512" aria-hidden="true" tabindex="-1"></a>    rmse_top <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred_top))</span>
<span id="cb21-513"><a href="#cb21-513" aria-hidden="true" tabindex="-1"></a>    r2_top <span class="op">=</span> r2_score(y_test, y_pred_top)</span>
<span id="cb21-514"><a href="#cb21-514" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Top 5 features RMSE: $</span><span class="sc">{</span>rmse_top<span class="sc">:.2f}</span><span class="ss">, RÂ²: </span><span class="sc">{</span>r2_top<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb21-515"><a href="#cb21-515" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-516"><a href="#cb21-516" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model with SelectKBest features</span></span>
<span id="cb21-517"><a href="#cb21-517" aria-hidden="true" tabindex="-1"></a>    X_train_kbest <span class="op">=</span> X_train[selected_features_kbest]</span>
<span id="cb21-518"><a href="#cb21-518" aria-hidden="true" tabindex="-1"></a>    X_test_kbest <span class="op">=</span> X_test[selected_features_kbest]</span>
<span id="cb21-519"><a href="#cb21-519" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-520"><a href="#cb21-520" aria-hidden="true" tabindex="-1"></a>    model_kbest <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb21-521"><a href="#cb21-521" aria-hidden="true" tabindex="-1"></a>    model_kbest.fit(X_train_kbest, y_train)</span>
<span id="cb21-522"><a href="#cb21-522" aria-hidden="true" tabindex="-1"></a>    y_pred_kbest <span class="op">=</span> model_kbest.predict(X_test_kbest)</span>
<span id="cb21-523"><a href="#cb21-523" aria-hidden="true" tabindex="-1"></a>    rmse_kbest <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred_kbest))</span>
<span id="cb21-524"><a href="#cb21-524" aria-hidden="true" tabindex="-1"></a>    r2_kbest <span class="op">=</span> r2_score(y_test, y_pred_kbest)</span>
<span id="cb21-525"><a href="#cb21-525" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"SelectKBest features RMSE: $</span><span class="sc">{</span>rmse_kbest<span class="sc">:.2f}</span><span class="ss">, RÂ²: </span><span class="sc">{</span>r2_kbest<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb21-526"><a href="#cb21-526" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-527"><a href="#cb21-527" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model with RFE features</span></span>
<span id="cb21-528"><a href="#cb21-528" aria-hidden="true" tabindex="-1"></a>    X_train_rfe <span class="op">=</span> X_train[selected_features_rfe]</span>
<span id="cb21-529"><a href="#cb21-529" aria-hidden="true" tabindex="-1"></a>    X_test_rfe <span class="op">=</span> X_test[selected_features_rfe]</span>
<span id="cb21-530"><a href="#cb21-530" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-531"><a href="#cb21-531" aria-hidden="true" tabindex="-1"></a>    model_rfe <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb21-532"><a href="#cb21-532" aria-hidden="true" tabindex="-1"></a>    model_rfe.fit(X_train_rfe, y_train)</span>
<span id="cb21-533"><a href="#cb21-533" aria-hidden="true" tabindex="-1"></a>    y_pred_rfe <span class="op">=</span> model_rfe.predict(X_test_rfe)</span>
<span id="cb21-534"><a href="#cb21-534" aria-hidden="true" tabindex="-1"></a>    rmse_rfe <span class="op">=</span> np.sqrt(mean_squared_error(y_test, y_pred_rfe))</span>
<span id="cb21-535"><a href="#cb21-535" aria-hidden="true" tabindex="-1"></a>    r2_rfe <span class="op">=</span> r2_score(y_test, y_pred_rfe)</span>
<span id="cb21-536"><a href="#cb21-536" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"RFE features RMSE: $</span><span class="sc">{</span>rmse_rfe<span class="sc">:.2f}</span><span class="ss">, RÂ²: </span><span class="sc">{</span>r2_rfe<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb21-537"><a href="#cb21-537" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-538"><a href="#cb21-538" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a comparison chart for RÂ² scores</span></span>
<span id="cb21-539"><a href="#cb21-539" aria-hidden="true" tabindex="-1"></a>    methods <span class="op">=</span> [<span class="st">'All Features'</span>, <span class="st">'Top 5 Features'</span>, <span class="st">'SelectKBest'</span>, <span class="st">'RFE'</span>]</span>
<span id="cb21-540"><a href="#cb21-540" aria-hidden="true" tabindex="-1"></a>    r2_scores <span class="op">=</span> [r2_all, r2_top, r2_kbest, r2_rfe]</span>
<span id="cb21-541"><a href="#cb21-541" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-542"><a href="#cb21-542" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a comparison bar chart</span></span>
<span id="cb21-543"><a href="#cb21-543" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb21-544"><a href="#cb21-544" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'#1f77b4'</span>, <span class="st">'#ff7f0e'</span>, <span class="st">'#2ca02c'</span>, <span class="st">'#d62728'</span>]</span>
<span id="cb21-545"><a href="#cb21-545" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> plt.bar(methods, r2_scores, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-546"><a href="#cb21-546" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-547"><a href="#cb21-547" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value labels on top of bars</span></span>
<span id="cb21-548"><a href="#cb21-548" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb21-549"><a href="#cb21-549" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> bar.get_height()</span>
<span id="cb21-550"><a href="#cb21-550" aria-hidden="true" tabindex="-1"></a>        plt.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="fl">2.</span>, height <span class="op">+</span> <span class="fl">0.01</span>,</span>
<span id="cb21-551"><a href="#cb21-551" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>height<span class="sc">:.3f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb21-552"><a href="#cb21-552" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-553"><a href="#cb21-553" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Styling</span></span>
<span id="cb21-554"><a href="#cb21-554" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'RÂ² Score'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb21-555"><a href="#cb21-555" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Model Performance (RÂ²) by Feature Selection Method'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-556"><a href="#cb21-556" aria-hidden="true" tabindex="-1"></a>    plt.ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb21-557"><a href="#cb21-557" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-558"><a href="#cb21-558" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb21-559"><a href="#cb21-559" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-560"><a href="#cb21-560" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-561"><a href="#cb21-561" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb21-562"><a href="#cb21-562" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb21-563"><a href="#cb21-563" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-564"><a href="#cb21-564" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a background</span></span>
<span id="cb21-565"><a href="#cb21-565" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb21-566"><a href="#cb21-566" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-567"><a href="#cb21-567" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-568"><a href="#cb21-568" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-569"><a href="#cb21-569" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-570"><a href="#cb21-570" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create actual vs predicted plot for the best model</span></span>
<span id="cb21-571"><a href="#cb21-571" aria-hidden="true" tabindex="-1"></a>    best_model <span class="op">=</span> model_top  <span class="co"># Using top features model</span></span>
<span id="cb21-572"><a href="#cb21-572" aria-hidden="true" tabindex="-1"></a>    y_pred_best <span class="op">=</span> best_model.predict(X_test_top)</span>
<span id="cb21-573"><a href="#cb21-573" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-574"><a href="#cb21-574" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb21-575"><a href="#cb21-575" aria-hidden="true" tabindex="-1"></a>    plt.scatter(y_test, y_pred_best, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-576"><a href="#cb21-576" aria-hidden="true" tabindex="-1"></a>    plt.plot([y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], [y_test.<span class="bu">min</span>(), y_test.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb21-577"><a href="#cb21-577" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Actual Income ($)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-578"><a href="#cb21-578" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Predicted Income ($)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-579"><a href="#cb21-579" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Actual vs Predicted Income'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-580"><a href="#cb21-580" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-581"><a href="#cb21-581" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb21-582"><a href="#cb21-582" aria-hidden="true" tabindex="-1"></a>    plt.grid(alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-583"><a href="#cb21-583" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-584"><a href="#cb21-584" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove spines</span></span>
<span id="cb21-585"><a href="#cb21-585" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb21-586"><a href="#cb21-586" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-587"><a href="#cb21-587" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb21-588"><a href="#cb21-588" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb21-589"><a href="#cb21-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-590"><a href="#cb21-590" aria-hidden="true" tabindex="-1"></a><span class="co"># Run predictive modeling with the fixed function</span></span>
<span id="cb21-591"><a href="#cb21-591" aria-hidden="true" tabindex="-1"></a>predict_income(df, potential_features)</span>
<span id="cb21-592"><a href="#cb21-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-593"><a href="#cb21-593" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis: Income by program</span></span>
<span id="cb21-594"><a href="#cb21-594" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis: Income by program</span></span>
<span id="cb21-595"><a href="#cb21-595" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> income_by_program(df):</span>
<span id="cb21-596"><a href="#cb21-596" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Income Outcomes by Program ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb21-597"><a href="#cb21-597" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-598"><a href="#cb21-598" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'PGMCIPAP'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns <span class="kw">or</span> <span class="st">'PERSINCP_midpoint'</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb21-599"><a href="#cb21-599" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Program or income data not available."</span>)</span>
<span id="cb21-600"><a href="#cb21-600" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb21-601"><a href="#cb21-601" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-602"><a href="#cb21-602" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to only employed individuals</span></span>
<span id="cb21-603"><a href="#cb21-603" aria-hidden="true" tabindex="-1"></a>    income_df <span class="op">=</span> df[df[<span class="st">'LFSTATP'</span>] <span class="op">==</span> <span class="dv">1</span>].copy() <span class="cf">if</span> <span class="st">'LFSTATP'</span> <span class="kw">in</span> df.columns <span class="cf">else</span> df.copy()</span>
<span id="cb21-604"><a href="#cb21-604" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-605"><a href="#cb21-605" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a mapping dictionary for program codes to names</span></span>
<span id="cb21-606"><a href="#cb21-606" aria-hidden="true" tabindex="-1"></a>    program_mapping <span class="op">=</span> {</span>
<span id="cb21-607"><a href="#cb21-607" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="st">"Education"</span>,</span>
<span id="cb21-608"><a href="#cb21-608" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="st">"Visual/performing arts/comms/humanities"</span>,</span>
<span id="cb21-609"><a href="#cb21-609" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="st">"Social/behavioral sciences/law"</span>,</span>
<span id="cb21-610"><a href="#cb21-610" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>: <span class="st">"Business/management/public admin"</span>,</span>
<span id="cb21-611"><a href="#cb21-611" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span>: <span class="st">"Physical/life sciences/technologies"</span>,</span>
<span id="cb21-612"><a href="#cb21-612" aria-hidden="true" tabindex="-1"></a>        <span class="dv">7</span>: <span class="st">"Math/computer/info sciences"</span>,</span>
<span id="cb21-613"><a href="#cb21-613" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span>: <span class="st">"Architecture/engineering/trades"</span>,</span>
<span id="cb21-614"><a href="#cb21-614" aria-hidden="true" tabindex="-1"></a>        <span class="dv">9</span>: <span class="st">"Health fields"</span>,</span>
<span id="cb21-615"><a href="#cb21-615" aria-hidden="true" tabindex="-1"></a>        <span class="dv">10</span>: <span class="st">"Other"</span>,</span>
<span id="cb21-616"><a href="#cb21-616" aria-hidden="true" tabindex="-1"></a>        <span class="dv">99</span>: <span class="st">"Not stated"</span></span>
<span id="cb21-617"><a href="#cb21-617" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-618"><a href="#cb21-618" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-619"><a href="#cb21-619" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by program and calculate mean income</span></span>
<span id="cb21-620"><a href="#cb21-620" aria-hidden="true" tabindex="-1"></a>    program_income <span class="op">=</span> income_df.groupby(<span class="st">'PGMCIPAP'</span>)[<span class="st">'PERSINCP_midpoint'</span>].agg([<span class="st">'mean'</span>, <span class="st">'count'</span>]).dropna()</span>
<span id="cb21-621"><a href="#cb21-621" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-622"><a href="#cb21-622" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out "Not stated" (code 99)</span></span>
<span id="cb21-623"><a href="#cb21-623" aria-hidden="true" tabindex="-1"></a>    program_income <span class="op">=</span> program_income[program_income.index <span class="op">!=</span> <span class="dv">99</span>]</span>
<span id="cb21-624"><a href="#cb21-624" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-625"><a href="#cb21-625" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Separate programs with sufficient data (&gt;50) and insufficient data (&lt;=50)</span></span>
<span id="cb21-626"><a href="#cb21-626" aria-hidden="true" tabindex="-1"></a>    sufficient_programs <span class="op">=</span> program_income[program_income[<span class="st">'count'</span>] <span class="op">&gt;</span> <span class="dv">50</span>]</span>
<span id="cb21-627"><a href="#cb21-627" aria-hidden="true" tabindex="-1"></a>    insufficient_programs <span class="op">=</span> program_income[program_income[<span class="st">'count'</span>] <span class="op">&lt;=</span> <span class="dv">50</span>]</span>
<span id="cb21-628"><a href="#cb21-628" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-629"><a href="#cb21-629" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize only programs with sufficient data</span></span>
<span id="cb21-630"><a href="#cb21-630" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sufficient_programs) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb21-631"><a href="#cb21-631" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sort by mean income</span></span>
<span id="cb21-632"><a href="#cb21-632" aria-hidden="true" tabindex="-1"></a>        sufficient_programs <span class="op">=</span> sufficient_programs.sort_values(<span class="st">'mean'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-633"><a href="#cb21-633" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-634"><a href="#cb21-634" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create visualization</span></span>
<span id="cb21-635"><a href="#cb21-635" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))  <span class="co"># Increased size to accommodate more categories</span></span>
<span id="cb21-636"><a href="#cb21-636" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-637"><a href="#cb21-637" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get program names using our mapping</span></span>
<span id="cb21-638"><a href="#cb21-638" aria-hidden="true" tabindex="-1"></a>        program_labels <span class="op">=</span> [program_mapping.get(pid, <span class="ss">f"Program </span><span class="sc">{</span>pid<span class="sc">}</span><span class="ss">"</span>) <span class="cf">for</span> pid <span class="kw">in</span> sufficient_programs.index]</span>
<span id="cb21-639"><a href="#cb21-639" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-640"><a href="#cb21-640" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create bar chart with vertical bars</span></span>
<span id="cb21-641"><a href="#cb21-641" aria-hidden="true" tabindex="-1"></a>        colors <span class="op">=</span> plt.cm.viridis(np.linspace(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="bu">len</span>(sufficient_programs)))</span>
<span id="cb21-642"><a href="#cb21-642" aria-hidden="true" tabindex="-1"></a>        bars <span class="op">=</span> ax.bar(<span class="bu">range</span>(<span class="bu">len</span>(sufficient_programs)), sufficient_programs[<span class="st">'mean'</span>], </span>
<span id="cb21-643"><a href="#cb21-643" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-644"><a href="#cb21-644" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-645"><a href="#cb21-645" aria-hidden="true" tabindex="-1"></a>        ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(sufficient_programs)))</span>
<span id="cb21-646"><a href="#cb21-646" aria-hidden="true" tabindex="-1"></a>        ax.set_xticklabels(program_labels, fontsize<span class="op">=</span><span class="dv">18</span>, rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb21-647"><a href="#cb21-647" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'Average Income ($)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-648"><a href="#cb21-648" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="st">'Average Income by Program (n &gt; 50)'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb21-649"><a href="#cb21-649" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-650"><a href="#cb21-650" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add value labels</span></span>
<span id="cb21-651"><a href="#cb21-651" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, bar <span class="kw">in</span> <span class="bu">enumerate</span>(bars):</span>
<span id="cb21-652"><a href="#cb21-652" aria-hidden="true" tabindex="-1"></a>            height <span class="op">=</span> bar.get_height()</span>
<span id="cb21-653"><a href="#cb21-653" aria-hidden="true" tabindex="-1"></a>            ax.text(bar.get_x() <span class="op">+</span> bar.get_width()<span class="op">/</span><span class="dv">2</span>, height <span class="op">+</span> <span class="dv">500</span>,</span>
<span id="cb21-654"><a href="#cb21-654" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f'$</span><span class="sc">{</span>height<span class="sc">:.0f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb21-655"><a href="#cb21-655" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-656"><a href="#cb21-656" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add grid</span></span>
<span id="cb21-657"><a href="#cb21-657" aria-hidden="true" tabindex="-1"></a>        ax.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb21-658"><a href="#cb21-658" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-659"><a href="#cb21-659" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove spines</span></span>
<span id="cb21-660"><a href="#cb21-660" aria-hidden="true" tabindex="-1"></a>        ax.spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb21-661"><a href="#cb21-661" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-662"><a href="#cb21-662" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb21-663"><a href="#cb21-663" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb21-664"><a href="#cb21-664" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-665"><a href="#cb21-665" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Print the results with more information</span></span>
<span id="cb21-666"><a href="#cb21-666" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Programs by Average Income (with sufficient data, n &gt; 50):"</span>)</span>
<span id="cb21-667"><a href="#cb21-667" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pid, row <span class="kw">in</span> sufficient_programs.iterrows():</span>
<span id="cb21-668"><a href="#cb21-668" aria-hidden="true" tabindex="-1"></a>            program_name <span class="op">=</span> program_mapping.get(pid, <span class="ss">f"Program </span><span class="sc">{</span>pid<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-669"><a href="#cb21-669" aria-hidden="true" tabindex="-1"></a>            avg_income <span class="op">=</span> row[<span class="st">'mean'</span>]</span>
<span id="cb21-670"><a href="#cb21-670" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> row[<span class="st">'count'</span>]</span>
<span id="cb21-671"><a href="#cb21-671" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-672"><a href="#cb21-672" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>program_name<span class="sc">}</span><span class="ss">: $</span><span class="sc">{</span>avg_income<span class="sc">:.0f}</span><span class="ss"> (n=</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb21-673"><a href="#cb21-673" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-674"><a href="#cb21-674" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Provide additional context</span></span>
<span id="cb21-675"><a href="#cb21-675" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Note: </span><span class="sc">{</span><span class="bu">len</span>(sufficient_programs)<span class="sc">}</span><span class="ss"> programs had sufficient data (&gt;50 respondents)"</span>)</span>
<span id="cb21-676"><a href="#cb21-676" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-677"><a href="#cb21-677" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"No programs had sufficient data (&gt;50 respondents) for visualization."</span>)</span>
<span id="cb21-678"><a href="#cb21-678" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-679"><a href="#cb21-679" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print information for programs with insufficient data</span></span>
<span id="cb21-680"><a href="#cb21-680" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(insufficient_programs) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb21-681"><a href="#cb21-681" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Programs with Limited Data (n &lt;= 50):"</span>)</span>
<span id="cb21-682"><a href="#cb21-682" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-683"><a href="#cb21-683" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sort by count (descending) to show programs with the most data first</span></span>
<span id="cb21-684"><a href="#cb21-684" aria-hidden="true" tabindex="-1"></a>        insufficient_programs <span class="op">=</span> insufficient_programs.sort_values(<span class="st">'count'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-685"><a href="#cb21-685" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-686"><a href="#cb21-686" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pid, row <span class="kw">in</span> insufficient_programs.iterrows():</span>
<span id="cb21-687"><a href="#cb21-687" aria-hidden="true" tabindex="-1"></a>            program_name <span class="op">=</span> program_mapping.get(pid, <span class="ss">f"Program </span><span class="sc">{</span>pid<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-688"><a href="#cb21-688" aria-hidden="true" tabindex="-1"></a>            avg_income <span class="op">=</span> row[<span class="st">'mean'</span>]</span>
<span id="cb21-689"><a href="#cb21-689" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> row[<span class="st">'count'</span>]</span>
<span id="cb21-690"><a href="#cb21-690" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb21-691"><a href="#cb21-691" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>program_name<span class="sc">}</span><span class="ss">: $</span><span class="sc">{</span>avg_income<span class="sc">:.0f}</span><span class="ss"> (n=</span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb21-692"><a href="#cb21-692" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-693"><a href="#cb21-693" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Note: </span><span class="sc">{</span><span class="bu">len</span>(insufficient_programs)<span class="sc">}</span><span class="ss"> programs had limited data (&lt;=50 respondents)"</span>)</span>
<span id="cb21-694"><a href="#cb21-694" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-695"><a href="#cb21-695" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">No programs had limited data (&lt;=50 respondents)."</span>)</span>
<span id="cb21-696"><a href="#cb21-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-697"><a href="#cb21-697" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the program analysis</span></span>
<span id="cb21-698"><a href="#cb21-698" aria-hidden="true" tabindex="-1"></a>income_by_program(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Available columns in dataset:
['PUMFID', 'CERTLEVP', 'REG_INST', 'REG_RESP', 'PGMCIPAP', 'PGM_P034', 'PGM_P036', 'PGM_P100', 'PGM_P111', 'PGM_280A', 'PGM_280B', 'PGM_280C', 'PGM_280D', 'PGM_280E', 'PGM_280F', 'PGM_290', 'PGM_350', 'PGM_380', 'PGM_P401', 'PGM_410', 'PGM_415', 'PGM_430', 'COV_010', 'COV_070', 'COV_080', 'EDU_010', 'EDU_P020', 'HLOSINTP', 'STL_010', 'STL_020', 'STULOANS', 'STL_030', 'OWESLGD', 'OWEGVIN', 'STL_080', 'STL_100A', 'STL_100B', 'STL_100C', 'STL_100D', 'STL_130', 'STL_150', 'STL_160B', 'STL_160C', 'STL_160D', 'STL_160E', 'STL_160F', 'STL_160G', 'STL_160H', 'STL_160I', 'STL_160J', 'STL_160L', 'STLP160N', 'SRCFUND', 'STL_170A', 'STL_170B', 'STL_170C', 'STL_170D', 'STL_170E', 'STL_170F', 'STL_170G', 'STL_170H', 'STL_170I', 'STL_170J', 'STL_170L', 'STLP170N', 'RESPP', 'STL_190', 'DBTOTGRD', 'DBTALGRD', 'DBTOTINT', 'DBTALINT', 'SCHOLARP', 'LMA_010', 'LFSTATP', 'LMA2_07', 'LMA3_P01', 'LFCINDP', 'LFCOCCP', 'LFWFTPTP', 'LMA6_05', 'LMA6_08', 'JOBQLEVP', 'JOBQLGRD', 'JOBQLINT', 'LMA6_11', 'LMA6_12', 'LMA6_13A', 'LMA6_13B', 'LMA6_13C', 'JOBINCP', 'LMA6_15', 'AFT_P010', 'AFT_P020', 'AFT_P040', 'AFT_050', 'AFT_070', 'AFT_080', 'AFT_090', 'BEF_P140', 'BEF_160', 'PREVLEVP', 'HLOSGRDP', 'PAR1GRD', 'PAR1INT', 'PAR2GRD', 'PAR2INT', 'GRADAGEP', 'GENDER2', 'MS_P01', 'MS_P02', 'CTZSHIPP', 'VISBMINP', 'PERSINCP', 'DDIS_FL']</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-8-output-2.png" width="1198" height="1889" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Fuxim\AppData\Local\Temp\ipykernel_23340\10805593.py:186: PerformanceWarning:

DataFrame is highly fragmented.  This is usually the result of calling `frame.insert` many times, which has poor performance.  Consider joining all columns at once using pd.concat(axis=1) instead. To get a de-fragmented frame, use `newframe = frame.copy()`

C:\Users\Fuxim\AppData\Local\Temp\ipykernel_23340\10805593.py:242: UserWarning:

set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Income Distribution Analysis ===

Total personal income in 2022 Statistics:
Mean: $59568.25
Median: $60000.00
Standard Deviation: $27797.41
Min: $15000.00
Max: $100000.00</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-8-output-5.png" width="1590" height="589" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Correlation Analysis ===
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-8-output-7.png" width="1162" height="962" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Using the following features for modeling: ['GENDER2', 'CERTLEVP', 'GRADAGEP', 'VISBMINP', 'CTZSHIPP', 'MS_P01', 'REG_INST', 'EDU_010', 'PGMCIPAP', 'STULOANS', 'JOBINCP', 'LFCINDP', 'LFCOCCP', 'LMA6_11', 'COV_010', 'LMA_010']

=== Predictive Modeling: Income Prediction ===

Removed job-related features: ['JOBINCP', 'LFCINDP', 'LFCOCCP', 'LMA6_11']
Using features: ['Gender after distribution of non-binary persons', '2020 Program - Level of study - Grouping', '2020 Program - Age at time of graduation - Grouping', 'Self-identified as a member of a visible minority group', 'Time of interview 2023 - Status in Canada', 'Marital status', '2020 Program - Region of postsecondary educational institution', 'After 2020 program - Other postsecondary programs taken', '2020 Program - Aggregated CIP 2021', 'Government-student loan program - Received', 'COVID-19 - Completion of program delayed', 'Reference week - Attended school, college, CEGEP or university']
1. SelectKBest Feature Selection:
Selected features: ['2020 Program - Level of study - Grouping', '2020 Program - Age at time of graduation - Grouping', 'Marital status', 'After 2020 program - Other postsecondary programs taken', 'Reference week - Attended school, college, CEGEP or university']

2. Recursive Feature Elimination (RFE):
Selected features: ['Gender after distribution of non-binary persons', '2020 Program - Level of study - Grouping', 'Marital status', 'After 2020 program - Other postsecondary programs taken', 'Reference week - Attended school, college, CEGEP or university']

3. Random Forest Feature Importance:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-8-output-9.png" width="1206" height="989" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 5 features: ['2020 Program - Level of study - Grouping', '2020 Program - Aggregated CIP 2021', '2020 Program - Region of postsecondary educational institution', '2020 Program - Age at time of graduation - Grouping', 'Marital status']

4. Model Performance Comparison:
All features RMSE: $23668.64, RÂ²: 0.252
Top 5 features RMSE: $22978.14, RÂ²: 0.295
SelectKBest features RMSE: $23148.84, RÂ²: 0.284
RFE features RMSE: $23134.13, RÂ²: 0.285</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-8-output-11.png" width="990" height="588" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-8-output-12.png" width="991" height="589" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Income Outcomes by Program ===
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-8-output-14.png" width="1191" height="789" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Programs by Average Income (with sufficient data, n &gt; 50):
Education: $68015 (n=957.0)
Math/computer/info sciences: $66123 (n=659.0)
Health fields: $64616 (n=1783.0)
Architecture/engineering/trades: $62753 (n=1618.0)
Business/management/public admin: $62100 (n=2819.0)
Other: $53815 (n=658.0)
Social/behavioral sciences/law: $52802 (n=1608.0)
Physical/life sciences/technologies: $50739 (n=575.0)
Visual/performing arts/comms/humanities: $41442 (n=780.0)

Note: 9 programs had sufficient data (&gt;50 respondents)

No programs had limited data (&lt;=50 respondents).</code></pre>
</div>
</div>
</section>
<section id="program-tiers-based-on-employment-and-income-clustering" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="program-tiers-based-on-employment-and-income-clustering"><span class="header-section-number">6.3</span> Program Tiers Based on Employment and Income (Clustering)</h2>
<div id="2301e42f" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set professional style for publication-quality figures</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'default'</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'DejaVu Sans'</span>  <span class="co"># Use a professional font</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titlesize'</span>] <span class="op">=</span> <span class="dv">14</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.labelsize'</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'xtick.labelsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'ytick.labelsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'legend.fontsize'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.titlesize'</span>] <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.titleweight'</span>] <span class="op">=</span> <span class="st">'bold'</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.dpi'</span>] <span class="op">=</span> <span class="dv">300</span>  <span class="co"># High resolution</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'savefig.dpi'</span>] <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'savefig.bbox'</span>] <span class="op">=</span> <span class="st">'tight'</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'savefig.pad_inches'</span>] <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cluster_program_tiers_enhanced(df):</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co">    Enhanced clustering of programs into three tiers based on employment rate and mean income.</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="co">    Uses a more sophisticated approach to handle limited income variation.</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"=== Enhanced Program Tier Clustering Based on Employment Outcomes ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check required columns</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    required_cols <span class="op">=</span> [<span class="st">'PGMCIPAP'</span>, <span class="st">'LFSTATP'</span>, <span class="st">'PERSINCP_midpoint'</span>]</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(col <span class="kw">in</span> df.columns <span class="cf">for</span> col <span class="kw">in</span> required_cols):</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Required columns not available for clustering."</span>)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to only employed and unemployed individuals</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>    employment_df <span class="op">=</span> df[df[<span class="st">'LFSTATP'</span>].isin([<span class="dv">1</span>, <span class="dv">2</span>])].copy()</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Program mapping</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    program_mapping <span class="op">=</span> {</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="st">"Education"</span>,</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="st">"Arts/Humanities"</span>,</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="st">"Social Sciences/Law"</span>,</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>: <span class="st">"Business/Management"</span>,</span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span>: <span class="st">"Life Sciences/Tech"</span>,</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>        <span class="dv">7</span>: <span class="st">"Math/Computer Science"</span>,</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span>: <span class="st">"Engineering/Trades"</span>,</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>        <span class="dv">9</span>: <span class="st">"Health Fields"</span>,</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>        <span class="dv">10</span>: <span class="st">"Other"</span>,</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>        <span class="dv">99</span>: <span class="st">"Not stated"</span></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate employment rate by program</span></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>    employment_counts <span class="op">=</span> employment_df.groupby(<span class="st">'PGMCIPAP'</span>)[<span class="st">'LFSTATP'</span>].value_counts().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>    employment_counts[<span class="st">'Employment_Rate'</span>] <span class="op">=</span> employment_counts[<span class="dv">1</span>] <span class="op">/</span> (employment_counts[<span class="dv">1</span>] <span class="op">+</span> employment_counts[<span class="dv">2</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate mean income by program (for employed individuals only)</span></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>    income_data <span class="op">=</span> df[df[<span class="st">'LFSTATP'</span>] <span class="op">==</span> <span class="dv">1</span>].groupby(<span class="st">'PGMCIPAP'</span>)[<span class="st">'PERSINCP_midpoint'</span>].mean()</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine the data</span></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>    program_stats <span class="op">=</span> pd.DataFrame({</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Employment_Rate'</span>: employment_counts[<span class="st">'Employment_Rate'</span>],</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mean_Income'</span>: income_data,</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Sample_Size'</span>: (employment_counts[<span class="dv">1</span>] <span class="op">+</span> employment_counts[<span class="dv">2</span>])</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>    }).dropna()</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out programs with insufficient data</span></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>    program_stats <span class="op">=</span> program_stats[(program_stats[<span class="st">'Sample_Size'</span>] <span class="op">&gt;=</span> <span class="dv">50</span>) <span class="op">&amp;</span> </span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>                                (program_stats[<span class="st">'Mean_Income'</span>].notna())]</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(program_stats) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Insufficient data for clustering."</span>)</span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize the metrics to 0-1 scale</span></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>    program_stats[<span class="st">'Employment_Rate_Norm'</span>] <span class="op">=</span> (program_stats[<span class="st">'Employment_Rate'</span>] <span class="op">-</span> program_stats[<span class="st">'Employment_Rate'</span>].<span class="bu">min</span>()) <span class="op">/</span> <span class="op">\</span></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>                                           (program_stats[<span class="st">'Employment_Rate'</span>].<span class="bu">max</span>() <span class="op">-</span> program_stats[<span class="st">'Employment_Rate'</span>].<span class="bu">min</span>())</span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>    program_stats[<span class="st">'Income_Norm'</span>] <span class="op">=</span> (program_stats[<span class="st">'Mean_Income'</span>] <span class="op">-</span> program_stats[<span class="st">'Mean_Income'</span>].<span class="bu">min</span>()) <span class="op">/</span> <span class="op">\</span></span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>                                  (program_stats[<span class="st">'Mean_Income'</span>].<span class="bu">max</span>() <span class="op">-</span> program_stats[<span class="st">'Mean_Income'</span>].<span class="bu">min</span>())</span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a weighted composite score (60% employment rate, 40% income)</span></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>    employment_weight <span class="op">=</span> <span class="fl">0.6</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>    income_weight <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>    program_stats[<span class="st">'Composite_Score'</span>] <span class="op">=</span> (employment_weight <span class="op">*</span> program_stats[<span class="st">'Employment_Rate_Norm'</span>] <span class="op">+</span> </span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a>                                       income_weight <span class="op">*</span> program_stats[<span class="st">'Income_Norm'</span>])</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data for clustering</span></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> program_stats[[<span class="st">'Composite_Score'</span>]].values</span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply K-means clustering with 3 clusters</span></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>    program_stats[<span class="st">'Cluster'</span>] <span class="op">=</span> kmeans.fit_predict(X)</span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Order clusters by composite score (higher score is better)</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>    cluster_means <span class="op">=</span> program_stats.groupby(<span class="st">'Cluster'</span>)[<span class="st">'Composite_Score'</span>].mean()</span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>    cluster_mapping <span class="op">=</span> {cluster: i<span class="op">+</span><span class="dv">1</span> <span class="cf">for</span> i, cluster <span class="kw">in</span> <span class="bu">enumerate</span>(cluster_means.sort_values(ascending<span class="op">=</span><span class="va">False</span>).index)}</span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>    program_stats[<span class="st">'Tier'</span>] <span class="op">=</span> program_stats[<span class="st">'Cluster'</span>].<span class="bu">map</span>(cluster_mapping)</span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add program names</span></span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>    program_stats[<span class="st">'Program_Name'</span>] <span class="op">=</span> program_stats.index.<span class="bu">map</span>(</span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: program_mapping.get(x, <span class="ss">f"Program </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display results</span></span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Program Tier Classification:"</span>)</span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tier <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>        tier_programs <span class="op">=</span> program_stats[program_stats[<span class="st">'Tier'</span>] <span class="op">==</span> tier].sort_values(<span class="st">'Composite_Score'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Tier </span><span class="sc">{</span>tier<span class="sc">}</span><span class="ss"> Programs (n=</span><span class="sc">{</span><span class="bu">len</span>(tier_programs)<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, row <span class="kw">in</span> tier_programs.iterrows():</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'Program_Name'</span>]<span class="sc">}</span><span class="ss">: "</span></span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Employment Rate: </span><span class="sc">{</span>row[<span class="st">'Employment_Rate'</span>]<span class="sc">:.1f}</span><span class="ss">%, "</span></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Mean Income: $</span><span class="sc">{</span>row[<span class="st">'Mean_Income'</span>]<span class="sc">:,.0f}</span><span class="ss">, "</span></span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Composite Score: </span><span class="sc">{</span>row[<span class="st">'Composite_Score'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create separate figures for each plot</span></span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Figure 1: Scatter plot</span></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">6</span>))</span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color mapping for tiers - professional color palette</span></span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> {<span class="dv">1</span>: <span class="st">'#2E8B57'</span>, <span class="dv">2</span>: <span class="st">'#FFA500'</span>, <span class="dv">3</span>: <span class="st">'#DC143C'</span>}  <span class="co"># SeaGreen, Orange, Crimson</span></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scatter plot (Employment Rate vs Mean Income)</span></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tier <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]:</span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a>        tier_data <span class="op">=</span> program_stats[program_stats[<span class="st">'Tier'</span>] <span class="op">==</span> tier]</span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a>        plt.scatter(tier_data[<span class="st">'Employment_Rate'</span>], tier_data[<span class="st">'Mean_Income'</span>], </span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a>                   c<span class="op">=</span>colors[tier], label<span class="op">=</span><span class="ss">f'Tier </span><span class="sc">{</span>tier<span class="sc">}</span><span class="ss">'</span>, s<span class="op">=</span><span class="dv">120</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add program labels with improved positioning</span></span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, row <span class="kw">in</span> tier_data.iterrows():</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a>            plt.annotate(row[<span class="st">'Program_Name'</span>], </span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>                        (row[<span class="st">'Employment_Rate'</span>], row[<span class="st">'Mean_Income'</span>]),</span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a>                        xytext<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>), textcoords<span class="op">=</span><span class="st">'offset points'</span>,</span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a>                        fontsize<span class="op">=</span><span class="dv">9</span>, alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a>                        bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">"round,pad=0.3"</span>, fc<span class="op">=</span><span class="st">"white"</span>, ec<span class="op">=</span><span class="st">"gray"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>))</span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Employment Rate (%)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Mean Income ($)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Program Tier Clustering Based on Employment Outcomes'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>    plt.xlim([<span class="dv">90</span>,<span class="dv">100</span>])</span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format y-axis with dollar signs</span></span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> currency_formatter(x, pos):</span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="ss">f'$</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">'</span></span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a>    plt.gca().yaxis.set_major_formatter(FuncFormatter(currency_formatter))</span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove top and right spines</span></span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a subtle background</span></span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Figure 2: Boxplot</span></span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">3</span>))</span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Prepare data for boxplot</span></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a>    box_data <span class="op">=</span> []</span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a>    tier_labels <span class="op">=</span> []</span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a>    tier_colors <span class="op">=</span> [<span class="st">'#2E8B57'</span>, <span class="st">'#FFA500'</span>, <span class="st">'#DC143C'</span>]  <span class="co"># SeaGreen, Orange, Crimson</span></span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, tier <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]):</span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>        tier_data <span class="op">=</span> program_stats[program_stats[<span class="st">'Tier'</span>] <span class="op">==</span> tier][<span class="st">'Mean_Income'</span>]</span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a>        box_data.append(tier_data)</span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a>        tier_labels.append(<span class="ss">f"Tier </span><span class="sc">{</span>tier<span class="sc">}</span><span class="ch">\n</span><span class="ss">(n=</span><span class="sc">{</span><span class="bu">len</span>(tier_data)<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create boxplot with enhanced styling</span></span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>    box_plot <span class="op">=</span> plt.boxplot(box_data, patch_artist<span class="op">=</span><span class="va">True</span>, widths<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize box colors</span></span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, patch <span class="kw">in</span> <span class="bu">enumerate</span>(box_plot[<span class="st">'boxes'</span>]):</span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>        patch.set_facecolor(tier_colors[i])</span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>        patch.set_alpha(<span class="fl">0.8</span>)</span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a>        patch.set_linewidth(<span class="fl">1.5</span>)</span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize other elements</span></span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> element <span class="kw">in</span> [<span class="st">'whiskers'</span>, <span class="st">'caps'</span>]:</span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a>        plt.setp(box_plot[element], color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> median <span class="kw">in</span> box_plot[<span class="st">'medians'</span>]:</span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a>        median.set_color(<span class="st">'black'</span>)</span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a>        median.set_linewidth(<span class="dv">2</span>)</span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize fliers (outliers)</span></span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> flier <span class="kw">in</span> box_plot[<span class="st">'fliers'</span>]:</span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a>        flier.<span class="bu">set</span>(marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb30-200"><a href="#cb30-200" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-201"><a href="#cb30-201" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set x-tick labels</span></span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a>    plt.xticks([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], tier_labels, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize labels and title</span></span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Income Distribution by Program Tier'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Program Tier'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Annual Income ($)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format y-axis with dollar signs</span></span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a>    plt.gca().yaxis.set_major_formatter(FuncFormatter(currency_formatter))</span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove top and right spines</span></span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add grid</span></span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add mean markers</span></span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, tier <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]):</span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>        mean_income <span class="op">=</span> program_stats[program_stats[<span class="st">'Tier'</span>] <span class="op">==</span> tier][<span class="st">'Mean_Income'</span>].mean()</span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a>        plt.plot(i<span class="op">+</span><span class="dv">1</span>, mean_income, <span class="st">'D'</span>, color<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">3</span>, markeredgecolor<span class="op">=</span><span class="st">'black'</span>, </span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a>                markeredgewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Mean'</span> <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">""</span>)</span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add legend for mean marker</span></span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, frameon<span class="op">=</span><span class="va">True</span>, fancybox<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-227"><a href="#cb30-227" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a subtle background</span></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print interpretation</span></span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation:"</span>)</span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Programs are classified into three tiers based on a composite score that considers:"</span>)</span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"- Employment Rate (weight: </span><span class="sc">{</span>employment_weight<span class="op">*</span><span class="dv">100</span><span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"- Mean Income (weight: </span><span class="sc">{</span>income_weight<span class="op">*</span><span class="dv">100</span><span class="sc">}</span><span class="ss">%)"</span>)</span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Tier 1: Programs with the best employment outcomes (highest composite scores)"</span>)</span>
<span id="cb30-240"><a href="#cb30-240" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Tier 2: Programs with moderate employment outcomes"</span>)</span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Tier 3: Programs with the weakest employment outcomes"</span>)</span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> program_stats</span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the enhanced clustering analysis</span></span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a>program_tiers_enhanced <span class="op">=</span> cluster_program_tiers_enhanced(df)</span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detailed_program_analysis(df, program_tiers):</span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a><span class="co">    Provide detailed analysis of program tiers with recommendations.</span></span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Detailed Program Tier Analysis ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a comprehensive visualization</span></span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Color mapping - using the same professional palette</span></span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> {<span class="dv">1</span>: <span class="st">'#2E8B57'</span>, <span class="dv">2</span>: <span class="st">'#FFA500'</span>, <span class="dv">3</span>: <span class="st">'#DC143C'</span>}  <span class="co"># SeaGreen, Orange, Crimson</span></span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot: Composite Score by Program</span></span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a>    program_tiers_sorted <span class="op">=</span> program_tiers.sort_values(<span class="st">'Composite_Score'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> plt.barh(program_tiers_sorted[<span class="st">'Program_Name'</span>], program_tiers_sorted[<span class="st">'Composite_Score'</span>],</span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a>                   color<span class="op">=</span>[colors[tier] <span class="cf">for</span> tier <span class="kw">in</span> program_tiers_sorted[<span class="st">'Tier'</span>]],</span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a>                   alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Composite Score'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-268"><a href="#cb30-268" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Program Composite Scores (Employment + Income)'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'x'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add value labels on the bars</span></span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> bars:</span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a>        width <span class="op">=</span> bar.get_width()</span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a>        plt.text(width <span class="op">+</span> <span class="fl">0.01</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f'</span><span class="sc">{</span>width<span class="sc">:.2f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove top and right spines</span></span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a>    plt.gca().spines[[<span class="st">'top'</span>, <span class="st">'right'</span>]].set_visible(<span class="va">False</span>)</span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a subtle background</span></span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a>    plt.gca().set_facecolor(<span class="st">'#f8f9fa'</span>)</span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjust layout to prevent clipping</span></span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print detailed recommendations</span></span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Program Tier Recommendations ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tier 1 programs</span></span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a>    tier1 <span class="op">=</span> program_tiers[program_tiers[<span class="st">'Tier'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Tier 1 Programs (Excellent Outcomes):"</span>)</span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> tier1.iterrows():</span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"âœ“ </span><span class="sc">{</span>row[<span class="st">'Program_Name'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Employment Rate: </span><span class="sc">{</span>row[<span class="st">'Employment_Rate'</span>]<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Mean Income: $</span><span class="sc">{</span>row[<span class="st">'Mean_Income'</span>]<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb30-298"><a href="#cb30-298" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Composite Score: </span><span class="sc">{</span>row[<span class="st">'Composite_Score'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb30-299"><a href="#cb30-299" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tier 2 programs</span></span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a>    tier2 <span class="op">=</span> program_tiers[program_tiers[<span class="st">'Tier'</span>] <span class="op">==</span> <span class="dv">2</span>]</span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Tier 2 Programs (Good Outcomes):"</span>)</span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> tier2.iterrows():</span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"âœ“ </span><span class="sc">{</span>row[<span class="st">'Program_Name'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Employment Rate: </span><span class="sc">{</span>row[<span class="st">'Employment_Rate'</span>]<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Mean Income: $</span><span class="sc">{</span>row[<span class="st">'Mean_Income'</span>]<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Composite Score: </span><span class="sc">{</span>row[<span class="st">'Composite_Score'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb30-310"><a href="#cb30-310" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-311"><a href="#cb30-311" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Specific recommendations for Tier 2 programs</span></span>
<span id="cb30-312"><a href="#cb30-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row.name <span class="op">==</span> <span class="dv">4</span>:  <span class="co"># Social/behavioral sciences/law</span></span>
<span id="cb30-313"><a href="#cb30-313" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"  â†’ Recommendation: Focus on increasing income potential through specialized certifications"</span>)</span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> row.name <span class="op">==</span> <span class="dv">7</span>:  <span class="co"># Math/computer/info sciences</span></span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"  â†’ Recommendation: Improve employment rates through industry partnerships"</span>)</span>
<span id="cb30-316"><a href="#cb30-316" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb30-317"><a href="#cb30-317" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tier 3 programs</span></span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a>    tier3 <span class="op">=</span> program_tiers[program_tiers[<span class="st">'Tier'</span>] <span class="op">==</span> <span class="dv">3</span>]</span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Tier 3 Programs (Needs Improvement):"</span>)</span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">40</span>)</span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, row <span class="kw">in</span> tier3.iterrows():</span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"âœ“ </span><span class="sc">{</span>row[<span class="st">'Program_Name'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Employment Rate: </span><span class="sc">{</span>row[<span class="st">'Employment_Rate'</span>]<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Mean Income: $</span><span class="sc">{</span>row[<span class="st">'Mean_Income'</span>]<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  - Composite Score: </span><span class="sc">{</span>row[<span class="st">'Composite_Score'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Specific recommendations for Tier 3 programs</span></span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> row.name <span class="op">==</span> <span class="dv">2</span>:  <span class="co"># Visual/performing arts/comms/humanities</span></span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"  â†’ Recommendation: Develop stronger career pathways and industry connections"</span>)</span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> row.name <span class="op">==</span> <span class="dv">6</span>:  <span class="co"># Physical/life sciences/technologies</span></span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"  â†’ Recommendation: Enhance practical skills training and industry alignment"</span>)</span>
<span id="cb30-333"><a href="#cb30-333" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> row.name <span class="op">==</span> <span class="dv">10</span>:  <span class="co"># Other</span></span>
<span id="cb30-334"><a href="#cb30-334" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"  â†’ Recommendation: Review and potentially restructure this program category"</span>)</span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-337"><a href="#cb30-337" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall recommendations</span></span>
<span id="cb30-338"><a href="#cb30-338" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Strategic Recommendations ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"1. Tier 1 Programs: Maintain excellence, consider expanding capacity"</span>)</span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"2. Tier 2 Programs: Targeted interventions to move programs to Tier 1"</span>)</span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"3. Tier 3 Programs: Comprehensive review and potential restructuring"</span>)</span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"4. Continuous Monitoring: Establish regular assessment of program outcomes"</span>)</span>
<span id="cb30-343"><a href="#cb30-343" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"5. Student Guidance: Use tier information for career counseling and program selection"</span>)</span>
<span id="cb30-344"><a href="#cb30-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-345"><a href="#cb30-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the detailed analysis</span></span>
<span id="cb30-346"><a href="#cb30-346" aria-hidden="true" tabindex="-1"></a>detailed_program_analysis(df, program_tiers_enhanced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== Enhanced Program Tier Clustering Based on Employment Outcomes ===
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\Fuxim\miniconda3\envs\quarto-env\lib\site-packages\sklearn\cluster\_kmeans.py:1419: UserWarning:

KMeans is known to have a memory leak on Windows with MKL, when there are less chunks than available threads. You can avoid it by setting the environment variable OMP_NUM_THREADS=1.
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Program Tier Classification:
============================================================

Tier 1 Programs (n=2):
----------------------------------------
Education: Employment Rate: 97.0%, Mean Income: $68,015, Composite Score: 1.000
Health Fields: Employment Rate: 96.9%, Mean Income: $64,616, Composite Score: 0.942

Tier 2 Programs (n=4):
----------------------------------------
Business/Management: Employment Rate: 95.3%, Mean Income: $62,100, Composite Score: 0.736
Math/Computer Science: Employment Rate: 93.3%, Mean Income: $66,123, Composite Score: 0.593
Engineering/Trades: Employment Rate: 93.4%, Mean Income: $62,753, Composite Score: 0.553
Social Sciences/Law: Employment Rate: 94.1%, Mean Income: $52,802, Composite Score: 0.475

Tier 3 Programs (n=3):
----------------------------------------
Other: Employment Rate: 91.8%, Mean Income: $53,815, Composite Score: 0.262
Life Sciences/Tech: Employment Rate: 92.3%, Mean Income: $50,739, Composite Score: 0.261
Arts/Humanities: Employment Rate: 91.1%, Mean Income: $41,442, Composite Score: 0.000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-9-output-4.png" width="2070" height="1769" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-9-output-5.png" width="1170" height="872" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation:
============================================================
Programs are classified into three tiers based on a composite score that considers:
- Employment Rate (weight: 60.0%)
- Mean Income (weight: 40.0%)

Tier 1: Programs with the best employment outcomes (highest composite scores)
Tier 2: Programs with moderate employment outcomes
Tier 3: Programs with the weakest employment outcomes

=== Detailed Program Tier Analysis ===
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NGS_Report_files/figure-html/cell-9-output-7.png" width="2969" height="1768" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Program Tier Recommendations ===

Tier 1 Programs (Excellent Outcomes):
----------------------------------------
âœ“ Education:
  - Employment Rate: 97.0%
  - Mean Income: $68,015
  - Composite Score: 1.000
âœ“ Health Fields:
  - Employment Rate: 96.9%
  - Mean Income: $64,616
  - Composite Score: 0.942

Tier 2 Programs (Good Outcomes):
----------------------------------------
âœ“ Social Sciences/Law:
  - Employment Rate: 94.1%
  - Mean Income: $52,802
  - Composite Score: 0.475
  â†’ Recommendation: Focus on increasing income potential through specialized certifications
âœ“ Business/Management:
  - Employment Rate: 95.3%
  - Mean Income: $62,100
  - Composite Score: 0.736
âœ“ Math/Computer Science:
  - Employment Rate: 93.3%
  - Mean Income: $66,123
  - Composite Score: 0.593
  â†’ Recommendation: Improve employment rates through industry partnerships
âœ“ Engineering/Trades:
  - Employment Rate: 93.4%
  - Mean Income: $62,753
  - Composite Score: 0.553

Tier 3 Programs (Needs Improvement):
----------------------------------------
âœ“ Arts/Humanities:
  - Employment Rate: 91.1%
  - Mean Income: $41,442
  - Composite Score: 0.000
  â†’ Recommendation: Develop stronger career pathways and industry connections
âœ“ Life Sciences/Tech:
  - Employment Rate: 92.3%
  - Mean Income: $50,739
  - Composite Score: 0.261
  â†’ Recommendation: Enhance practical skills training and industry alignment
âœ“ Other:
  - Employment Rate: 91.8%
  - Mean Income: $53,815
  - Composite Score: 0.262
  â†’ Recommendation: Review and potentially restructure this program category


=== Strategic Recommendations ===

1. Tier 1 Programs: Maintain excellence, consider expanding capacity
2. Tier 2 Programs: Targeted interventions to move programs to Tier 1
3. Tier 3 Programs: Comprehensive review and potential restructuring
4. Continuous Monitoring: Establish regular assessment of program outcomes
5. Student Guidance: Use tier information for career counseling and program selection</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Conclusion</h1>
<p>This project successfully transitions the NGS dataset from a static repository of information into a dynamic tool for strategic decision-making. The creation of an interactive dashboard ensures these insights remain accessible for ongoing exploration.</p>
<p>The central, unequivocal finding is that field of study is the primary engine of post-graduation success. This truth allows us to move from anecdotal evidence to a data-driven understanding of our program offerings, clearly identifying areas of strength and opportunity.</p>
<p>The path forward is clear. We must act on these insights by:</p>
<ol type="1">
<li><p>Strategically amplifying our high-demand, high-outcome programs.</p></li>
<li><p>Innovating and enhancing programs with greater market challenges through curriculum integration and robust career support.</p></li>
<li><p>Empowering students with this data to make informed decisions about their educational investment.</p></li>
</ol>
<p>By embedding these insights into our academic strategy, student support, and marketing communications, we commit to a future of continuous improvement. This data-driven approach will not only elevate graduate outcomes but also solidify our reputation as an institution dedicated to delivering tangible, lifelong value.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>